(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{431:function(t,s,e){"use strict";e.r(s);var a=e(56),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"nginx优化及防盗链"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nginx优化及防盗链"}},[t._v("#")]),t._v(" Nginx优化及防盗链")]),t._v(" "),e("p",[t._v("​    在企业信息化应用环境中，服务器的安全性和响应速度需要根据实际情况进行相应参数配置,以达到最优的用户体验。默认的Nginx安装参数只能提供最基本的服务，需要调整如网页缓存时间、连接超时、网页压缩等相应参数，发挥出服务器的最大作用。")]),t._v(" "),e("h2",{attrs:{id:"_1、隐藏版本等信息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、隐藏版本等信息"}},[t._v("#")]),t._v(" 1、隐藏版本等信息")]),t._v(" "),e("p",[t._v("在生产环境中，需要隐藏Nginx的版本号， 以避免泄漏Nginx的版本， 使攻击者不能针对特定版本进行攻击。\n优化前访问:")]),t._v(" "),e("div",{staticClass:"language-http extra-class"},[e("pre",{pre:!0,attrs:{class:"language-http"}},[e("code",[e("span",{pre:!0,attrs:{class:"token response-status"}},[e("span",{pre:!0,attrs:{class:"token http-version property"}},[t._v("HTTP/1.1")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token status-code number"}},[t._v("200")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token reason-phrase string"}},[t._v("OK")])]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token header"}},[e("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("server")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token header-value"}},[t._v("nginx/1.16.0\t#版本信息")])]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token header"}},[e("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Date")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token header-value"}},[t._v("Thu, 04 Jul 2019 15:06:57 GMT")])]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token header"}},[e("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Content-Type")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token header-value"}},[t._v("text/html; charset=utf-8")])]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token header"}},[e("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Content-Length")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token header-value"}},[t._v("626")])]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token header"}},[e("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Last-Modified")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token header-value"}},[t._v("Mon， 01 Jul 2019 09:26:46 GMT")])]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token header"}},[e("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Connection")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token header-value"}},[t._v("keep-alive")])]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token header"}},[e("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("ETag")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token header-value"}},[t._v('"5d19d1d6-272"')])]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token header"}},[e("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Accept-Ranges")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token header-value"}},[t._v("bytes")])]),t._v("\n")])])]),e("h3",{attrs:{id:"优化方式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#优化方式"}},[t._v("#")]),t._v(" 优化方式")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("修改主配置文件")]),t._v(" "),e("p",[t._v("将Nginx的配置文件中的server_tokens选项值设置为off,如没有该配置项,加上即可。")]),t._v(" "),e("div",{staticClass:"language-nginx extra-class"},[e("pre",{pre:!0,attrs:{class:"language-nginx"}},[e("code",[e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("include")]),t._v("\t\t mime.types")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default_type")]),t._v(" application/octet-stream")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_tokens")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("off")])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n…………\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#省略很多内容")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])]),t._v(" "),e("p",[t._v("使用了php处理动态网页,如果php配置文件中配置了fastcgi_param SERVER_SOFTWARE选项,则编辑php-fpm配置文件，将fastcgi_param SERVER_SOFTWARE对应的值修改为fastcgi_param SERVER_SOFTWARE nginx。")]),t._v(" "),e("p",[t._v("重启服务后，再次查看：")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("  $ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -I http://127.0.0.1\n  HTTP/1.1 "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" OK\n  Server: nginx\n  Date: Tue, "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(" Apr "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":35:15 GMT\n  Content-Type: text/html\n  Content-Length: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("612")]),t._v("\n  Last-Modified: Tue, "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(" Apr "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(":35:13 GMT\n  Connection: keep-alive\n  ETag: "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5e9ef691-264"')]),t._v("\n  Accept-Ranges: bytes\n")])])]),e("ul",[e("li",[e("p",[e("strong",[t._v("编译安装前修改源码")])]),t._v(" "),e("p",[t._v("编译前的优化主要是用来修改程序名等等，目的更改源码隐藏软件名称和版本号。")]),t._v(" "),e("p",[t._v("1.进入解压后的源码目录,进行修改")]),t._v(" "),e("p",[t._v("​\t修改前")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" src/core/nginx.h\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#define NGINX_VERSION\t   "1.16.0"\t  #定义的版本号')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#define NGINX_VER\t\t  "nginx/" NGINX_VERSION  #定义的软件名称')]),t._v("\n")])])]),e("p",[t._v("​\t修改后")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" src/core/nginx.h\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#define NGINX_VERSION\t\t"7.0"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#define NGINX_VER\t\t\t"IIS/" NGINX_VERSION')]),t._v("\n")])])]),e("p",[t._v("2、修改HTTP头信息中的connection字段，防止回显具体版本号")]),t._v(" "),e("p",[t._v("拓展:通用http头,通用头包含请求和响应消息都支持的头，通用头包含Cache-Control、Connection、Date、 Pragma、 Transfer-Encoding、 Upgrade、 Via。 对通用头的扩展要求通讯双方都支持此扩展，如果存在不支持的通用头, 一般将会作为实体头处理。那么也就是说有部分设备或者是软件能获取到connection， 要隐藏就要彻底!")]),t._v(" "),e("p",[t._v("​\t修改前：")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" src/core/nginx.h\nstatic u_char ngx_http_error_tail"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<hr><center>nginx</center>"')]),t._v(" CRLF\n"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"</body>"')]),t._v(" CRLF\n'"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("/html"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v('" CRLF\n'),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])]),t._v(" "),e("p",[t._v("修改后：")]),t._v(" "),e("div",{staticClass:"language-html extra-class"},[e("pre",{pre:!0,attrs:{class:"language-html"}},[e("code",[t._v('  static u_char ngx_http_error_tail[] =\n  "'),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("hr")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("center")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("IIS"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("center")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v('" CRLF\n  "'),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v('" CRLF\n  "'),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v('" CRLF\n  ;\n')])])]),e("p",[t._v("修改完毕后进行编译安装，安装完成后,查看测试:")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("  $ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -I http://127.0.0.1\n  HTTP/1.1 "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" OK\n  Server: IIS/7.0 \n  …………\t\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#省略很多内容")]),t._v("\n")])])]),e("h2",{attrs:{id:"_2、工作进程数优化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、工作进程数优化"}},[t._v("#")]),t._v(" 2、工作进程数优化")]),t._v(" "),e("p",[t._v("Nginx默认只开启一个worker进程， 一般都设置为CPU个数，查看CPU个数使用如下命令:")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" -C "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'processor'")]),t._v(" /proc/cpuinfo\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\n")])])]),e("p",[t._v("所以应该配置成：")]),t._v(" "),e("div",{staticClass:"language-nginx extra-class"},[e("pre",{pre:!0,attrs:{class:"language-nginx"}},[e("code",[e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("worker_processes")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("worker_cpu_affinity")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0001")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0010")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0100")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#将每个工作进程绑定到单独的CPU")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("worker_rlimit_nofile")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("65535")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#工作进程打开的最大文件数")]),t._v("\n")])])]),e("p",[t._v("也可以这样调整(1.9.0版本后)")]),t._v(" "),e("div",{staticClass:"language-nginx extra-class"},[e("pre",{pre:!0,attrs:{class:"language-nginx"}},[e("code",[e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("worker_processes")]),t._v(" auto")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("worker_cpu_affinity")]),t._v(" auto")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#1.9.10版本后允许将工作进程自动绑定到可用的CPU")]),t._v("\n")])])]),e("p",[t._v("打开的最大文件数还要和系统的一致，使用ulimit -n查看，如果不一致,需要调整")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /etc/security/limits.conf\n* soft nofile "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("65535")]),t._v("\n* hard nofile "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("65535")]),t._v("\n* soft noproc "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("65535")]),t._v("\n* hard noproc "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("65535")]),t._v("\n")])])]),e("h2",{attrs:{id:"_3、nginx事件处理模型"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3、nginx事件处理模型"}},[t._v("#")]),t._v(" 3、Nginx事件处理模型")]),t._v(" "),e("div",{staticClass:"language-nginx extra-class"},[e("pre",{pre:!0,attrs:{class:"language-nginx"}},[e("code",[e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("events")])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" epoll")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("worker_connections")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("8192")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("accept_mutex")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("multi_accept")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("nginx采用epolI事件模型，处理效率高。")]),t._v(" "),e("p",[t._v("work_connections是单个worker进程允许客户端最大连接数,这个数值一般根据服务器性能和内存来制定，实际最大值就是worker进程数乘以work_connections")]),t._v(" "),e("p",[t._v("accept_mutex（ [əkˈsept]  //,mjuː ˈtɛks//）如果启用on,工作进程将轮流接受新的连接。否则，将通知所有工作进程有关新连接的信息,但只有一个进程可以获得连接。如果新连接的数量较低，则某些工作进程可能会浪费系统资源。如果是并发连接数很大的情况，应该调整为off.新版本默认是off,在版本1.1 1.3之前，默认值为on。")]),t._v(" "),e("p",[t._v("multi_accept指令使得NGINX worker能够在获得新连接的通知时尽可能多的接受连接。此指令的作用是立即接受所有连接放到监听队列中。如果指令被禁用, worker进程将逐个接受连接。默认是off。")]),t._v(" "),e("h2",{attrs:{id:"_4、开启高效传输模式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4、开启高效传输模式"}},[t._v("#")]),t._v(" 4、开启高效传输模式")]),t._v(" "),e("div",{staticClass:"language-nginx extra-class"},[e("pre",{pre:!0,attrs:{class:"language-nginx"}},[e("code",[e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("include")]),t._v("\t\t\tmime.types")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default_type")]),t._v(" \tapplication/octet-stream")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sendfile")]),t._v("\t\t"),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("tcp_nopush")]),t._v("\t\t"),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("include mime.types; //媒体类型,include只是一个在当前文件中包含另一个文件内容的指令。\ndefault_type application/octet-stream;  //默认媒体类型")]),t._v(" "),e("p",[t._v("sendfile on; //开启高效文件传输模式，sendfile指令指定nginx是否调用sendfile函数来输出文件，对于普通应用设为on,如果用来进行下载等应用磁盘I/0重负载应用，可设置为off, 以平衡磁盘与网络I/O处理速度，降低系统的负载。注意:如果图片显示不正常把这个改成off。当Nginx是一个静态文件服务器的时候，开启sendfile配置项能大大提高Nginx的性能。")]),t._v(" "),e("p",[t._v("tcp_nopush on;必须在sendfile开启模式才有效,防止网路阻塞,积极的减少网络报文段的数量(告诉nginx在一个数据包里发送所有头文件,而不是一个接一个的发送。 同tcp_nodelay选项互斥)")]),t._v(" "),e("h2",{attrs:{id:"_5、连接超时时间"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5、连接超时时间"}},[t._v("#")]),t._v(" 5、连接超时时间")]),t._v(" "),e("p",[t._v("主要目的是保护服务器资源，CPU,内存,控制连接数，因为建立连接也是需要消耗资源的")]),t._v(" "),e("div",{staticClass:"language-nginx extra-class"},[e("pre",{pre:!0,attrs:{class:"language-nginx"}},[e("code",[e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("keepalive_timeout")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("tcp_nodelay")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("client_header_buffer_size")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("4k")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("open_file_cache")]),t._v(" max=102400 inactive=20s")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("open_file_cache_valid")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("30s")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("open_file_cache_min_uses")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("client_header_timeout")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("client_body_timeout")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("reset_timedout_connection")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("send_timeout")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_tokens")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("off")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("client_max_body_size")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10m")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("keepalived_timeout客户端连接保持会话超时时间,超过这个时间，服务器断开这个链接")]),t._v(" "),e("p",[t._v("tcp_nodelay off,会增加通信的延时,但是会提高带宽利用率。在高延时、数据量大的通信场景中应该会有不错的效果;tcp_nodelay on,会增加小包的数量,但是可以提高响应速度。在及时性高的通信场景中应该会有不错的效果;")]),t._v(" "),e("p",[t._v("client_header_buffer_size 4k;\n客户端请求头部的缓冲区大小，这个可以根据你的系统分页大小来设置，一般一个请求头的大小不会超过1k,不过由于一般系统分页都要大于1k, 所以这里设置为分页大小。分页大小可以用命令getconf PAGESIZE取得。")]),t._v(" "),e("p",[t._v("open_file_cache max=102400 inactive=20s;\n这个将为打开文件指定缓存，默认是没有启用的，max指定缓存数量,建议和打开文件数一致，inactive是指经过多长时间文件没被请求后删除缓存。")]),t._v(" "),e("p",[t._v("open_file_cache_valid 30s;这个是指多长时间检查一次缓存的有效信息。\nopen_file_cache_min_uses 1;open_file_cache 指令中的inactive参数时间内文件的最少使用次数，如果超过这个数字，文件描述符一直是在缓存中打开的，如上例，如果有一个文件在inactive时间内一次没被使用，它将被移除")]),t._v(" "),e("p",[t._v("client_header_timeout设置请求头的超时时间。我们也可以把这个设置低些，如果超过这个时间没有发送任何数据，nginx将返回request time out的错误")]),t._v(" "),e("p",[t._v("client_body_timeout设置请求体的超时时间。我们也可以把这个设置低些，超过这个时间没有发送任何数据，和上面一样的错误提示")]),t._v(" "),e("p",[t._v("reset_timeout_connection 告诉nginx关闭不响应的客户端连接。这将会释放那个客户端所占有的内存空间。")]),t._v(" "),e("p",[t._v("send_timeout响应客户端超时时间，这个超时时间仅限于两个活动之间的时间，如果超过这个时间，客户端没有任何活动，nginx 关闭连接")]),t._v(" "),e("p",[t._v("client_max_body_size.上传文件大小限制。")]),t._v(" "),e("h2",{attrs:{id:"_6、fastcgi调优"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6、fastcgi调优"}},[t._v("#")]),t._v(" 6、fastcgi调优")]),t._v(" "),e("div",{staticClass:"language-nginx extra-class"},[e("pre",{pre:!0,attrs:{class:"language-nginx"}},[e("code",[e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fastcgi_connect_timeout")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("600")])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fastcgi_send_timeout")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("600")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fastcgi_read_timeout")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("600")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fastcgi_buffer_size")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("64k")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fastcgi_buffers")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("64k")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fastcgi_busy_buffers_size")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("128k")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fastcgi_temp_file_write_size")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("128k")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fastcgi_temp_path")]),t._v(" /usr/local/nginx1.10/nginx_tmp")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fastcgi_intercept_errors")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fastcgi_cache_path")]),t._v(" /usr/1ocal/nginx1.10/fastcgi_cache levels=1:2\nkeys_zone=cache_fastcgi:128m\ninactive=1d max_size=10g")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("fastcgi_connect_timeout 600; #指定连接到后端FastCGI的超时时间。\nfastcgi_send_timeout 600; #向FastCGl传送请求的超时时间。\nfastcgi_read_timeout 600; #指定接收FastCGI应答的超时时间。\nfastcgi_buffer_size 64k; #指定读取FastCGI应答第一部分需要用多大的缓冲区，默认的缓冲区大小为一个内存页大小(4K或者8K)，可以将这个值设置更小。")]),t._v(" "),e("p",[t._v('fastcgi_buffers 4 64k; #指定本地需要用多少和多大的缓冲区来缓冲FastCGl的应答请求,如果一个php脚本所产生的页面大小为256KB,那么会分配4个64KB的缓冲区来缓存,如果页面大小大于256KB,那么大于256KB的部分会缓存到fastcgi_temp_path指定的路径中，但是这并不是好方法,因为内存中的数据处理速度要快于磁盘。一般这个值应该为站点中 php脚本所产生的页面大小的中间值，如果站点大部分脚本所生的页面大小为256KB,那么可以把这个值设置为“8 32K"、“4 64k”等。')]),t._v(" "),e("p",[t._v("fastcgi_busy_buffers_size 128k; #建议设置为fastcgi_buffers的两倍，繁忙时候的buffer")]),t._v(" "),e("p",[t._v("fastcgi_temp_file_write_size 128k; #在写入fastcgi_temp_path 时将用多大的数据块，默认值是fastcgi_ buffers的两倍,该数值设置过小时若负载上来时可能报502 Bad Gateway")]),t._v(" "),e("p",[t._v("fastcgi_temp_path #缓存临时目录")]),t._v(" "),e("p",[t._v("fastcgi_intercept_errors on;#这个指令指定是否传递4xx和5xx错误信息到客户端，或者允许nginx使用error_page处理错误信息。注:静态文件不存在会返回404页面，但是php页面则返回空白页!")]),t._v(" "),e("p",[t._v("fastcgi_cache_path /usr/local/nginx1.1 0/fastcgi_cache levels=1:2 keys_zone=cache_fastcgi:128m\ninactive=1d.max_size=10g; # fastcgi_cache 缓存目录，可以设置目录层级，比如1:2会生成16*256个子目录，cache_fastcgi 是这个缓存空间的名字，cache 是用多少内存(这样热门的内容nginx直接放内存，提高访问速度)，inactive表示默认失效时间，如果缓存数据在失效时间内没有被访问，将被删除，max_size 表示最多用多少硬盘空间。")]),t._v(" "),e("p",[t._v("fastcgi_cache cache_fastcgi; #表示开启FastCGI缓存并为其指定一个名称。开启缓存非常有用，可以有效降低CPU的负载，并且防止502的错误发生。cache_fastcgi为proxy_cache_path指令创建的缓存区名称")]),t._v(" "),e("p",[t._v("fastcgi_cache_valid 200 302 1h;#用来指定应答代码的缓存时间,实例中的值表示将200和302应答缓存一小时，要和fastcgi. cache配合使用")]),t._v(" "),e("p",[t._v("fastcgi_cache. valid 301 1d; #将301应答缓存一天")]),t._v(" "),e("p",[t._v("fastcgi_cache_valid any 1m; #将其他应答缓存为1分钟\nfastcgi_cache_min_uses 1; #该指令用于设置经过多少次请求的相同URL将被缓存。\nfastcgi_cache_key http://$host$request_uri; #该指令用来设置web缓存的Key值,nginx根据Key值md5哈希存储,一-般根据$host(域名)、$request_uri(请求的路径)等变量组合成proxy_cache_key")]),t._v(" "),e("p",[e("strong",[t._v("总结：")])]),t._v(" "),e("p",[t._v("nginx的缓存功能有: proxy_cache和fastcgi_cache")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("proxy_cache的作用是缓存后端服务器的内容,可能是任何内容,包括静态的和动态。")])]),t._v(" "),e("li",[e("p",[t._v("fastcgi_cache的作用是缓存fastcgj生成的内容，很多情况是php生成的动态的内容。")])]),t._v(" "),e("li",[e("p",[t._v("proxy_cache缓存减少了nginx与后端通信的次数，节省了传输时间和后端宽带。")])]),t._v(" "),e("li",[e("p",[t._v("fastcgi_cache缓存减少了nginx与php的通信的次数， 更减轻了php和数据库(mysql)的压力。")])])]),t._v(" "),e("h2",{attrs:{id:"_7、gzip调优"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_7、gzip调优"}},[t._v("#")]),t._v(" 7、gzip调优")]),t._v(" "),e("p",[t._v("使用gzip压缩功能，可节约带宽，加快传输速度,有更好的体验,也为我们节约成本,所以说这是一个重点。Nginx启用压缩功能需要你来ngx_http_gzip_module模块，apache使用的是mod_deflate. 一般我们需要压缩的内容有:文本，js, html, Css, 对于图片,视频，flash什么的不压缩，同时也要注意,使用gzip的功能是需要消耗CPU的。")]),t._v(" "),e("div",{staticClass:"language-nginx extra-class"},[e("pre",{pre:!0,attrs:{class:"language-nginx"}},[e("code",[e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("gzip")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("gzip_min_length")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2k")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("gzip_buffers")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("32k")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("gzip_http_version")]),t._v(" 1.1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("gzip_comp_level")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("gzip_types")]),t._v(" text/plain text/css text/javascript application/json\napplication/javascript\napplication/x-javascript application/xml")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("gzip_vary "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("gzip_proxied")]),t._v(" any")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("gzip on; #开启压缩功能\ngzip_min_length 1k; #设置允许压缩的页面最小字节数，页面字节数从header头的Content-Length中获取，默认值是20字节,建议设置成大于1K,如果小于1 K可能会越压越大。")]),t._v(" "),e("p",[t._v("gzip_buffers 4 32k; #压缩缓冲区大小,表示申请4个单位为32K的内存作为压缩结果流缓存,默认值是申请与原始数据大小相同的内存空间来存储gzip压缩结果。")]),t._v(" "),e("p",[t._v("gzip_http_version 1.1; #压缩版本，用于设置识别HTTP协议版本,默认是1.1,目前大部分浏览器已经支持GZIP解压，使用默认即可")]),t._v(" "),e("p",[t._v("gzip_comp_level 6; #压缩比例，用来指定GZIP压缩比，1压缩比最小，处理速度最快，9压缩比最大,传输速度快，但是处理慢，也比较消耗CPU资源。默认是1")]),t._v(" "),e("p",[t._v("gzip_types text/css text/xml application/javascript; #用来指定压缩的类型，'text/html类型总是会被压缩。默认值: gzip_types text/html (默认不对js/CSS文件进行压缩)")]),t._v(" "),e("p",[t._v('gzip_vary on;开启和关闭插入"Vary: Accept-Encoding"响应头区域')]),t._v(" "),e("p",[t._v('gzip_proxied any; #Nginx作为反向代理的时候启用,根据后端服务器的相应头区域是否有"Via”区域来开启或者是关闭压缩。any就是所有的代理请求都压缩。')]),t._v(" "),e("h2",{attrs:{id:"_8、配置网页缓存时间"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_8、配置网页缓存时间"}},[t._v("#")]),t._v(" 8、配置网页缓存时间")]),t._v(" "),e("p",[t._v("当Nginx将网页数据返回给客户端后，可设置缓存的时间，以方便在日后进行相同内容的请求时直接返回，以避免重复请求，加快了访问速度，一般针对静态资源进行设置, 对动态网页不用设置缓存时间。\n下面对图片做缓存配置:")]),t._v(" "),e("div",{staticClass:"language-nginx extra-class"},[e("pre",{pre:!0,attrs:{class:"language-nginx"}},[e("code",[e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" ~ \\.(gif|jpg|jpeg|png|bmp|ico)$")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\t\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#加入新的location")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v(" html")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("expires")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1d")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\t\t\t\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#指定缓存时间")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("设置缓存一天的时间，一天之内浏览器访问这个页面， 都是用缓存中的数据，而不需要向Nginx服务器重新发出请求，减少了服务器的使用带宽。")]),t._v(" "),e("p",[e("strong",[t._v("总结：")])]),t._v(" "),e("p",[e("strong",[t._v("expire功能优点:")])]),t._v(" "),e("ul",[e("li",[t._v("expires可以降低网站购买的带宽， 节约成本")]),t._v(" "),e("li",[t._v("同时提升用户访问体验")]),t._v(" "),e("li",[t._v("减轻服务的压力，节约服务器成本，是web服务非常重要的功能。")]),t._v(" "),e("li",[e("strong",[t._v("expire功能缺点:")])]),t._v(" "),e("li",[t._v("被缓存的页面或数据更新了,用户看到的可能还是旧的内容,反而影响用户体验。")]),t._v(" "),e("li",[t._v("解决办法:\n。第一个缩短缓存时间，例如: 1天,但不彻底，除非更新频率大于1天;\n。第二个对缓存的对象改名。")]),t._v(" "),e("li",[t._v("网站不希望被缓存的内容:\n。网站流量统计工具\n。更新频繁的文件(google的logo)")])]),t._v(" "),e("h2",{attrs:{id:"_9、防盗链"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_9、防盗链"}},[t._v("#")]),t._v(" 9、防盗链")]),t._v(" "),e("p",[t._v("在企业网站服务中，一般都要配置防盗链功能，以避免网站内容被非法盗用，造成经济损失，也避免了不必要的带宽浪费。Nginx的防盗链功能也非常强大，在默认情况下，只需要进行很简单的配置，即可实现防盗链处理。")]),t._v(" "),e("div",{staticClass:"language-nginx extra-class"},[e("pre",{pre:!0,attrs:{class:"language-nginx"}},[e("code",[e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" ~* \\.(jpg|gif|swf)$")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("valid_referers")]),t._v(" none blocked web.test.cn")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" ("),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$invalid_referer")]),t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rewrite")]),t._v(" ^/ http://web.test.cn/meinv02.jpg")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v("   /usr/share/nginx/html/web")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("Nginx的防盗链原理是加入location项，用正则表达式过滤图片类型文件,对于信任的网址可以正常使用，不信任的网址返回相应的错误图片。")]),t._v(" "),e("h2",{attrs:{id:"_10、内核参数优化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_10、内核参数优化"}},[t._v("#")]),t._v(" 10、内核参数优化")]),t._v(" "),e("p",[t._v("fs.file-max = 999999:")]),t._v(" "),e("p",[t._v("这个参数表示进程(比如一个worker进程)可以同时打开的最大句柄数，这个参数直线限制最大并发连接数，需根据实际情况配置。")]),t._v(" "),e("p",[t._v("net.ipv4.tcp_max_tw_buckets = 6000")]),t._v(" "),e("p",[t._v("这个参数表示操作系统允许TIME_WAIT套接字数量的最大值,如果超过这个数字，TIME_WAIT套接字将立刻被清除并打印警告信息。该参数默认为180000,过多的TIME_WAIT套接字会使Web服务器变慢。\n注:主动关闭连接的服务端会产生 TIME_WAIT状态的连接")]),t._v(" "),e("p",[t._v("net.ipv4.ip_local_port_range = 1024 65000\n允许系统打开的端口范围")]),t._v(" "),e("p",[t._v("net.ipv4.tcp_tw_recycle= 1\n启用timewait快速回收")]),t._v(" "),e("p",[t._v("net.ipv4.tcp_tw_reuse= 1\n开启重用。允许将TIME-WAIT sockets重新用于新的TCP连接。这对于服务器来说很有意义,因为服务器上总会有大量TIME-WAIT状态的连接。")]),t._v(" "),e("p",[t._v("net.ipv4.tcp_keepalive_time= 30\n这个参数表示当keepalive启用时，TCP发送keepalive消息的频度。默认是2小时,若将其设置的小一些，可以更快地清理无效的连接。")]),t._v(" "),e("p",[t._v("net.ipv4.tcp_syncookies= 1\n开启SYN Cookies当出现SYN等待队列溢出时，启用cookies来处理。该参数与性能无关，用于解决TCP的SYN攻击。")]),t._v(" "),e("p",[t._v("net.core.somaxconn = 40960\nsomaxconn参数:定义了系统中每一个端口最大的监听队列的长度，这是个全局的参数默认值为128，对于一个经常处理新连接的高负载web服务环境来说，默认的128太小了。大多数环境这个值建议增加到1024或者更多。大的侦听队列对防止拒绝服务DoS攻击也会有所帮助。\nweb应用中listen函数的backlog默认会给我们内核参数的net.core.somaxconn限制到128,而nginx定义的NGX_LISTEN_BACKLOG 默认为511,所以有必要调整这个值。\n注:对于一 个TCP连接, Server与Client需要通过三次握手来建立网络连接.当三次握手成功后,我们可以看到端口的状态由LISTEN转变为ESTABLISHED（ [ɪˈstæblɪʃt] 建立），接着这条链路上就可以开始传送数据了。每一个处于监听(Listen)状态的端口,都有自己的监听队列.监听队列的长度与此somaxconn参数和使用该端口的程序中listen()函数有关")]),t._v(" "),e("p",[t._v("net.core.netdev_max_backlog = 262144\n每个网络接口接收数据包的速率比内核处理这些包的速率快时，允许送到队列的数据包的最大数目。")]),t._v(" "),e("p",[t._v("net.ipv4.tcp_max_syn_backlog = 262144\n这个参数标示TCP三次握手建立阶段接受SYN请求队列的最大长度,默认为1024,将其设置得大一些可以使出现Nginx繁忙来不及accept新连接的情况时，Linux 不至于丢失客户端发起的连接请求。")]),t._v(" "),e("p",[t._v("net.ipv4.tcp_rmem = 10240 87380 12582912\n这个参数定义了TCP接受缓存(用于TCP接受滑动窗口)的最小值、默认值、最大值。")]),t._v(" "),e("p",[t._v("net.ipv4.tcp_wmem = 10240 87380 12582912\n这个参数定义了TCP发送缓存(用于TCP发送滑动窗口)的最小值、默认值、最大值。")]),t._v(" "),e("p",[t._v("net.core.rmem_default = 6291456\n这个参数表示内核套接字接受缓存区默认的大小。")]),t._v(" "),e("p",[t._v("net.core.wmem_default = 6291456\n这个参数表示内核套接字发送缓存区默认的大小。")]),t._v(" "),e("p",[t._v("net.core.rmem_max= 12582912\n这个参数表示内核套接字接受缓存区的最大大小。")]),t._v(" "),e("p",[t._v("net.core.wmem_max = 12582912\n这个参数表示内核套接字发送缓存区的最大大小。")]),t._v(" "),e("h3",{attrs:{id:"内核优化案例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#内核优化案例"}},[t._v("#")]),t._v(" 内核优化案例")]),t._v(" "),e("div",{staticClass:"language-nginx extra-class"},[e("pre",{pre:!0,attrs:{class:"language-nginx"}},[e("code",[t._v("fs.file-max = 99999\nnet.ipv4.ip_forward = 0\nnet.ipv4.conf.default.rp_filter = 1\nnet.ipv4.conf.default.accept_source_route = 0\nkernel.sysrq = 0\nkernel.core_uses_pid = 1\nnet.ipv4.tcp_syncookies = 1\nkernel.msgmnb = 65536\nkernel.msgmax = 65536\nkernel.shmmax = 68719476736\nkernel.shmall = 4294967296\nnet.ipv4.tcp_max_tw_buckets = 6000\nnet.ipv4.tcp_sack = 1\nnet.ipv4.tcp_window_scaling = 1\nnet.ipv4.tcp_rmem = 10240 87380 12582912\nnet.ipv4.tcp_wmem = 10240 87380 12582912\nnet.core.wmem_default = 8388608\nnet.core.rmem_default = 8388608\nnet.core.rmem_max = 16777216\nnet.core.wmem_max = 16777216\nnet.core.netdev_max_backlog = 262144\nnet.core.somaxconn = 40960\nnet.ipv4.tcp_max_orphans = 3276800\nnet.ipv4.tcp_max_syn_backlog = 262144\nnet.ipv4.tcp_timestamps = 0\nnet.ipv4.tcp_synack_retries = 1\nnet.ipv4.tcp_syn_retries = 1\nnet.ipv4.tcp_tw_recycle = 1\nnet.ipv4.tcp_tw_reuse = 1\nnet.ipv4.tcp_mem = 94500000 915000000 927000000\nnet.ipv4.tcp_fin_timeout = 1\nnet.ipv4.tcp_keepalive_time = 30\nnet.ipv4.ip_local_port_range = 1024 65000\n")])])]),e("p",[t._v("执行sysctl -p 使内核修改生效")]),t._v(" "),e("h3",{attrs:{id:"实验优化案例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实验优化案例"}},[t._v("#")]),t._v(" 实验优化案例")]),t._v(" "),e("p",[e("strong",[t._v("部署实验环境")])]),t._v(" "),e("p",[t._v("1、部署LNMP环境(略)")]),t._v(" "),e("p",[t._v("2、一个完整的Nginx配置文件案例")]),t._v(" "),e("div",{staticClass:"language-nginx extra-class"},[e("pre",{pre:!0,attrs:{class:"language-nginx"}},[e("code",[e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("user")]),t._v(" www www")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("worker_processes")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" :\nworker_cpu_affinity "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0001")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0010")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0100")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("worker_rlimit_nofile")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("65535")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("error_log")]),t._v(" logs/error.log")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#error_log logs/error.log notice; ")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#error_log logs/error.log info; ")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pid")]),t._v(" logs/nginx.pid")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("events")])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" epoll")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("worker_connections")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("8192")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("multi_accept")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("include")]),t._v(" mime.types")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default_type")]),t._v(" application/octet-stream")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("log_format")]),t._v(" main "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),t._v(" - "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_user")]),t._v(" ["),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$time_local]")]),t._v(' "'),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request")]),t._v("\" '")]),t._v("\n\t\t\t\t   "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$status")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$body_bytes_sent")]),t._v(" ”"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_referer")]),t._v("'")]),t._v("\n\t\t\t\t   "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\""),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_user_agent")]),t._v('" "Shttp_x_forwarded_for"\'')])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#access_log logs/access.log main;")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sendfile")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("tcp_nopush")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("keepalive_timeout")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("65")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("tcp_nodelay")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("client_header_buffer_size")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("4k")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("open_file_cache")]),t._v(" max=102400 inactive=20s")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("open_file_cache_valid")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("30s")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("open_file_cache_min_uses")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\tclient_header_timeout "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("client_body_timeout")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("reset_timedout_connection")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("send_timeout")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_tokens")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("off")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("client_max_body_size")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10m")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fastcgi_connect")]),t._v(" timeout "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("600")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fastcgi_send")]),t._v(" timeout "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("600")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fastcgi_read")]),t._v(" timeout "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("600")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fastcgi_buffer_size")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("64k")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fastcgi_buffers")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("64k")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fastcgi_busy_buffers_size")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("128k")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fastcgi_temp_file_write_size")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("128k")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fastcgi_temp")]),t._v(" path /usr/local/nginx1.10/nginx_tmp")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fastcgi_intercept_errors")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fastcgi_cache_path")]),t._v(" /usr/local/nginx1.10/fastcgi_cache levels=1:2\n\tkeys_zone=cache_fastcgi:128m inactive=1d max_size=10g")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("gzip")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("gzip_min_length")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2k")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("gzip_buffers")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("32k")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("gzip_http_version "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("1.1")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("gzip_comp_level")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("gzip_types")]),t._v(" text/plain text/css text/javascript application/json\napplication/javascript\napplication/x-javascript application/xml")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("gzip_vary")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("gzip_proxied")]),t._v(" any")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v(" www.shengzhe.com")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#charset koi8-r;")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#access_log logs/host.access.log main;")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" ~* ^.+\\.(jpg|gif|png|swf|flv|wma|wmv|asf|mp3|mmf|zip|rar)$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("valid_referers")]),t._v(" none blocked www.shengzhe.com shengzhe.com")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" ("),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$invalid_referer")]),t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#return 302 http://www.shengzhe.com/img/nolink.jpg;")]),t._v("\n\t\t\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("access_log")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("off")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v(" html")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v(" index.php index.html index.htm")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" ~* \\.(ico|jpeg|gif|png|bmp|swf|flv)$")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("expires")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("30d")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#log_not_found off;")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("access_log")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("off")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" ~* \\.(js|css)$")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("expires")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("7d")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("log_not_found")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("off")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("access_log")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("off")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" = /(favicon.ico|roboots.txt)")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("access_log")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("off")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("log_not_found")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("off")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /status")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("stub_status")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" ~ . *\\.(php|php5)?$")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v(" html")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fastcgi_pass")]),t._v(" 127.0.0.1:9000")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fastcgi_index")]),t._v(" index.php")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("include")]),t._v(" fastcgi.conf")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fastcgi_cache")]),t._v(" cache_fastcgi")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fastcgi_cache_alid")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("302")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1h")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fastcgi_cache_valid")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("301")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1d")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fastcgi_cache_valid")]),t._v(" any "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1m")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fastcgi_cache_min_uses")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fastcgi_cache_use_stale")]),t._v(" error timeout invalid_header http_500")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fastcgi_cache_key")]),t._v(" http://"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_uri")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#error_page 404 /404.html;")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# redirect server error pages to the static page /50x.html")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("error_page")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("502")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("504")]),t._v(" /50x.html")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" = /50x.html")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v(" html")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),e("h3",{attrs:{id:"验证、压力测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#验证、压力测试"}},[t._v("#")]),t._v(" 验证、压力测试")]),t._v(" "),e("h4",{attrs:{id:"_1-验证防盗链"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-验证防盗链"}},[t._v("#")]),t._v(" "),e("strong",[t._v("1.验证防盗链")])]),t._v(" "),e("p",[t._v("使用Apache做为一个测试站点，域名为www.test.com,在测试页上做一个超链接， 链接nginx站点的一张图片")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /var/www/html/index.html\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("a "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("href")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://www.shengzhe.com/11.gif"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("lianjie"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("/a"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),e("p",[t._v("Nginx站点的网页目录结如下:")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ tree -C /usr/local/nginx1.16/html/\n/usr/local/nginx1.16/html/\n├── "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(".gif\n├── 50x.html\n├── img\n│       └── nolink.jpg\n├── index.html\n├── mysql_test.php\n└── test.php\n\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" directory, "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(" files\n")])])]),e("p",[t._v("在客户端浏览器中输入:www.test.com")]),t._v(" "),e("p",[e("img",{attrs:{src:"lmages/1.png",alt:""}})]),t._v(" "),e("p",[t._v("点击页面链接，可以看到防盗链设置已经生效")]),t._v(" "),e("p",[e("img",{attrs:{src:"lmages/2.png",alt:""}})]),t._v(" "),e("h4",{attrs:{id:"_2-验证gzip功能"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-验证gzip功能"}},[t._v("#")]),t._v(" "),e("strong",[t._v("2.验证gzip功能")])]),t._v(" "),e("p",[t._v("使用谷歌浏览器测试访问，如下图显示结果: (提示: 在访问测试页之前按F12键)")]),t._v(" "),e("p",[e("img",{attrs:{src:"lmages/3.png",alt:""}})]),t._v(" "),e("p",[t._v("用户访问test.php文件， 在上图中content-encoding:gzip表明响应给用户的数据是压缩传输。")]),t._v(" "),e("h4",{attrs:{id:"_3-压力测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-压力测试"}},[t._v("#")]),t._v(" 3.压力测试")]),t._v(" "),e("p",[t._v("网站性能压力测试是服务器网站性能调优过程中必不可缺少的一环。只有让服务器处在高压情况下，才能真正体现出软件、硬件等各种设置不当所暴露出的问题。")]),t._v(" "),e("p",[t._v("性能测试工具目前最常见的有以下几种: ab、http_load、webbench、siege。\nab是apache自带的压力测试工具。ab非常实用，它不仅可以对apache服务器进行网站访问压力测试，也可以对或其它类型的服务器进行压力测试。比如nginx、tomcat、 llS等。\n需要安装才能使用:")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ yum "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" httpd-tools -y\n")])])]),e("p",[t._v("最常用的参数:")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("-n\t总的要执行多少个请求数\n-C\t一次要发出的请求数"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("并发数"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("p",[t._v("执行以下测试命令")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ ab -C "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v(" -n "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("50000")]),t._v(" http://192.168.154.140/index.html\nThis is ApacheBench, version "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.3")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$Revision")]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1430300")]),t._v(" $"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nCopyright "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1996")]),t._v(" Adam Twiss，Zeus Technology Ltd，http://www.zeustech.net/\nLicensed to The Apache Software Foundation, http://www.apache.org/\nBenchmarking "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".154.140 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("be patient"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),t._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),t._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("15000")]),t._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("20000")]),t._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("25000")]),t._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("30000")]),t._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("35000")]),t._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("40000")]),t._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("45000")]),t._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("50000")]),t._v(" requests\nFinished "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("50000")]),t._v(" requests\n\nServer Software:\tnginx\nServer Hostname "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v("\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".154.140\nServer Port:\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n\nDocument Path:\t\t/index.html\nDocument Length:\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("626")]),t._v(" bytes\n\nconcurrency Level:\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v("\nTime taken "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" tests:\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("32.916")]),t._v(" seconds\nComplete requests:\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("50000")]),t._v("\nFailed requests "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v("\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Connect: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("，Receive: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("，Length: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v("，Exceptions: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),t._v(" errors:\t\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\nTotal transferred: \t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("42600000")]),t._v(" bytes\nHTML transferred:\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("31300000")]),t._v(" bytes\nRequests per second:\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1519.01")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#/sec] (mean)")]),t._v("\nTime per request:\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("329.161")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mean"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nTime per request:\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.658")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mean， across a11 concurrent requests "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nTransfer rate:\t\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1263.87")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Kbytes/sec"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" received\n\nConnection Times "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ms "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t\tmin\tmean"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("+/-sd"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\tmedian\tmax\nConnect "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v("\t   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("85")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("26.8")]),t._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("83")]),t._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("367")]),t._v("\nProcessing:\t   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("95")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("168.8")]),t._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("92")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("15002")]),t._v("\nwaiting:       "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("28.5")]),t._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("59")]),t._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("374")]),t._v("\nTotal "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v("\t\t  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("82")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("181")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("168.5")]),t._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("172")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("15002")]),t._v("\n\nPercentage of the requests served within a certain "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("time")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("%\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("172")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("66")]),t._v("%\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("179")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("75")]),t._v("%\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("184")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("%\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("187")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("90")]),t._v("%\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("198")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("95")]),t._v("%\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("209")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("98")]),t._v("%\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("250")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("99")]),t._v("%\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("370")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("% \t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("15002")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("longest request"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("p",[e("strong",[t._v("ab性能指标")])]),t._v(" "),e("p",[t._v("1、吞吐率(Requests per second)")]),t._v(" "),e("p",[t._v("服务器并发处理能力的量化描述，单位是reqs/s, 指的是在某个并发用户数下单位时间内处理的请求数。某个并发用户数下单位时间内能处理的最大请求数,称之为最大吞吐率。")]),t._v(" "),e("p",[t._v("记住:吞吐率是基于并发用户数的。这句话代表了两个含义:")]),t._v(" "),e("ul",[e("li",[t._v("吞吐率和并发用户数相关")]),t._v(" "),e("li",[t._v("不同的并发用户数下,吞吐率一般是不同的")])]),t._v(" "),e("p",[t._v("计算公式:总请求数/处理完成这些请求数所花费的时间，即\nRequest per second=Complete requests/Time taken for tests\n必须要说明的是，这个数值表示当前机器的整体性能，值越大越好。")]),t._v(" "),e("p",[t._v("2.并发连接数(The number of concurrent connections)")]),t._v(" "),e("p",[t._v("并发连接数指的是某个时刻服务器所接受的请求数目,简单的讲，就是一个会话")]),t._v(" "),e("p",[t._v("3.并发用户数(Concurrency Level)")]),t._v(" "),e("p",[t._v("要注意区分这个概念和并发连接数之间的区别，一个用户可能同时会产生多个会话，也即连接数。在HTTP/1.1下，IE7支持两个并发连接，IE8支持6个并发连接， FireFox3支持4个并发连接,所以相应的，我们的并发用户数就得除以这个基数。")]),t._v(" "),e("p",[t._v("4.用户平均请求等待时间(Time per request)")]),t._v(" "),e("p",[t._v("计算公式:处理完成所有请求数所花费的时间/ (总请求数/并发用户数)，即:")]),t._v(" "),e("p",[t._v("Time per request=Time taken for tests/ (Complete requests/Concurrency Level)")]),t._v(" "),e("p",[t._v("5.服务器平均请求等待时间(Time per request:across all concurrent requests)")]),t._v(" "),e("p",[t._v("计算公式:处理完成所有请求数所花费的时间/总请求数,即:")]),t._v(" "),e("p",[t._v("Time taken for/testsComplete requests")]),t._v(" "),e("p",[t._v("可以看到，它是吞吐率的倒数。")]),t._v(" "),e("p",[t._v("同时，它也等于用户平均请求等待时间/并发用户数,即")]),t._v(" "),e("p",[t._v("Time per request/Concurrency Level")]),t._v(" "),e("p",[e("strong",[t._v("第二次压力测试，比较两次的差异")])]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ ab -C "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(" -n "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),t._v(" http://192.168.154.140/index.html\nThis is ApacheBench，version "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.3")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("SRevision: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1430300")]),t._v(" $"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nCopyright "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1996")]),t._v(" Adam Twiss，Zeus Technology Ltd, http://www.zeustech.net/\nLicensed to The Apache software Foundation, http://www.apache.org/\n\nBenchmarking "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".154.140 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("be patient"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),t._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("20000")]),t._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("30000")]),t._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("40000")]),t._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("50000")]),t._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("60000")]),t._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("70000")]),t._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("80000")]),t._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("90000")]),t._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("100000")]),t._v(" requests\nFinished "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("100000")]),t._v(" requests\n\nServer Software:\tnginx\nServer Hostname "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v("\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".154.140\nServer Port:\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n\nDocument Path:\t\t/index.html\nDocument Length:\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("626")]),t._v(" bytes\n\nconcurrency Level:\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\nTime taken "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" tests:\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("50.908")]),t._v(" seconds\nComplete requests:\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),t._v("\nFailed requests "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v("\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("39")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Connect: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("，Receive: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("，Length: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v("，Exceptions: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),t._v(" errors:\t\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\nTotal transferred: \t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("85200000")]),t._v(" bytes\nHTML transferred:\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("62600000")]),t._v(" bytes\nRequests per second:\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1964.33")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#/sec] (mean)")]),t._v("\nTime per request:\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("509.080")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mean"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nTime per request:\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.658")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mean， across a11 concurrent requests "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nTransfer rate:\t\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1634.38")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Kbytes/sec"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" received\n\n\nConnection Times "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ms "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t\tmin\tmean"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("+/-sd"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\tmedian\t max\nConnect "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v("\t   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("173")]),t._v("  \t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("50.7")]),t._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("171")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("638")]),t._v("\nProcessing:\t  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("189")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("211.9")]),t._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("183")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("15010")]),t._v("\nwaiting:       "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("122")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("54.4")]),t._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("115")]),t._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("472")]),t._v("\nTotal "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v("\t\t "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("191")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("361")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("207.8")]),t._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("349")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("15010")]),t._v("\n\nPercentage of the requests served within a certain "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("time")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("%\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("349")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("66")]),t._v("%\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("359")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("75")]),t._v("%\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("366")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("%\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("371")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("90")]),t._v("%\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("385")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("95")]),t._v("%\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("400")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("98")]),t._v("%\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("461")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("99")]),t._v("%\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("603")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("% \t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("15010")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("longest request"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("h4",{attrs:{id:"_4-opcache提高php访向速度"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-opcache提高php访向速度"}},[t._v("#")]),t._v(" 4.opcache提高PHP访向速度")]),t._v(" "),e("p",[t._v("Opcache的前生是Optimizer+（ [ˈɑptəˌmaɪzər]优化器 ）,它是PHP的官方公司Zend开发的一款闭源但可以免费使用的PHP优化加速组件。Optimizer+将PHP代码预编译生成的脚本文件Opcode缓存在共享内存中供以后反复使用，从而避免了从磁盘读取代码再次编译的时间消耗。同时，它还应用了一些代码优化模式，使得代码执行更快。从而加速PHP的执行。\n安装")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ yum "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" php72w-opcache -y\n")])])]),e("p",[t._v("官方推荐配置")]),t._v(" "),e("div",{staticClass:"language-nginx extra-class"},[e("pre",{pre:!0,attrs:{class:"language-nginx"}},[e("code",[t._v("opcache.enable=1\nopcache.memory_consumption=128\nopcache.interned_strings_buffer=8\nopcache.max_accelerated files=4000\nopcache.revalidate_freq=60\nopcache.fast_shutdown=1\nopcache.enab1e_cli=1\n")])])]),e("p",[t._v("测试PHP动态页面")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ ab -C "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(" -n "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("100000")]),t._v(" http://192.168.154.140/test.php\nThis is ApacheBench，version "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.3")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$Revision")]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1430300")]),t._v(" $"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nCopyright "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1996")]),t._v(" Adam Twiss，Zeus Technology Ltd，http://www.zeustech.net/\nLicensed to The Apache software Foundation, http://www.apache.org/\n\nBenchmarking "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".154.140 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("be patient"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),t._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("20000")]),t._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("30000")]),t._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("40000")]),t._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("50000")]),t._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("60000")]),t._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("70000")]),t._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("80000")]),t._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("90000")]),t._v(" requests\nCompleted "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("100000")]),t._v(" requests\nFinished "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("100000")]),t._v(" requests\n\nServer Software:\tnginx\nServer Hostname "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v("\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".154.140\nServer Port:\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n\nDocument Path:\t\t/text.php\nDocument Length:\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("73746")]),t._v(" bytes\n\nconcurrency Level:\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\nTime taken "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" tests:\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("43.004")]),t._v(" seconds\nComplete requests:\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),t._v("\nFailed requests "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v("\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),t._v(" errors:\t\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\nTotal transferred: \t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("7392500000")]),t._v(" bytes\nHTML transferred:\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("7371600000")]),t._v(" bytes\nRequests per second:\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2325.39")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#/sec] (mean)")]),t._v("\nTime per request:\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("430.036")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mean"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nTime per request:\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.430")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mean， across a11 concurrent requests "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nTransfer rate:\t\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("167875.33")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Kbytes/sec"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" received\n\n\nConnection Times "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t\tmin\tmean"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("+/-sd"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\tmedian\t max\nConnect "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v("\t   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("78")]),t._v("  \t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("54.3")]),t._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("67")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("524")]),t._v("\nProcessing:\t  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("38")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("350")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("80.6")]),t._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("343")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("824")]),t._v("\nwaiting:       "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("51")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("33.8")]),t._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("44")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")]),t._v("\nTotal "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v("\t\t "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("112")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("428")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("77.3")]),t._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("409")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("899")]),t._v("\n\nPercentage of the requests served within a certain "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("time")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("%\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("405")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("66")]),t._v("%\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("420")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("75")]),t._v("%\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("435")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("%\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("449")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("90")]),t._v("%\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("504")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("95")]),t._v("%\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("595")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("98")]),t._v("%\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("694")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("99")]),t._v("%\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("767")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("% \t"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("899")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("longest request"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);