<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nginx网站服务 | ONEMUE Docs</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="This is a Docs.">
    
    <link rel="preload" href="/docs/assets/css/0.styles.90a57e95.css" as="style"><link rel="preload" href="/docs/assets/js/app.27b283a1.js" as="script"><link rel="preload" href="/docs/assets/js/2.2e8f894a.js" as="script"><link rel="preload" href="/docs/assets/js/14.4f6283b3.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.f6f629b0.js"><link rel="prefetch" href="/docs/assets/js/11.84b24849.js"><link rel="prefetch" href="/docs/assets/js/12.76af45bb.js"><link rel="prefetch" href="/docs/assets/js/13.c0ae4be6.js"><link rel="prefetch" href="/docs/assets/js/15.002291f6.js"><link rel="prefetch" href="/docs/assets/js/16.5dfc5cc5.js"><link rel="prefetch" href="/docs/assets/js/17.14f17db6.js"><link rel="prefetch" href="/docs/assets/js/18.971e9caa.js"><link rel="prefetch" href="/docs/assets/js/19.889fb802.js"><link rel="prefetch" href="/docs/assets/js/20.d1be27fd.js"><link rel="prefetch" href="/docs/assets/js/21.83fd3971.js"><link rel="prefetch" href="/docs/assets/js/22.6bc785a8.js"><link rel="prefetch" href="/docs/assets/js/23.c9474e02.js"><link rel="prefetch" href="/docs/assets/js/24.054109cd.js"><link rel="prefetch" href="/docs/assets/js/25.c7f91c21.js"><link rel="prefetch" href="/docs/assets/js/3.ea118fbe.js"><link rel="prefetch" href="/docs/assets/js/4.6fbf7596.js"><link rel="prefetch" href="/docs/assets/js/5.f7d53cbe.js"><link rel="prefetch" href="/docs/assets/js/6.db4bfcd5.js"><link rel="prefetch" href="/docs/assets/js/7.2123913f.js"><link rel="prefetch" href="/docs/assets/js/8.c52818c0.js"><link rel="prefetch" href="/docs/assets/js/9.20e728b8.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.90a57e95.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">ONEMUE Docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/docs/" aria-current="page" class="sidebar-link">内容构建中</a></li><li><a href="/docs/unicloud.html" class="sidebar-link">出现两年的 uniCloud</a></li><li><a href="/docs/han-shu-de-yi-xie-yan-jiu.html" class="sidebar-link">/han-shu-de-yi-xie-yan-jiu.html</a></li><li><a href="/docs/mian-shi.html" class="sidebar-link">面试汇总</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java Script</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Nginx</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Nginx安装及配置</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Nginx模块管理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>LNMP环境部署</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/nginx/03_lnmphuan-jing-bu-shu/1.nginxwang-zhan-fu-wu.html" aria-current="page" class="active sidebar-link">Nginx网站服务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/nginx/03_lnmphuan-jing-bu-shu/1.nginxwang-zhan-fu-wu.html#_1-安装nginx" class="sidebar-link">1. 安装Nginx</a></li><li class="sidebar-sub-header"><a href="/docs/nginx/03_lnmphuan-jing-bu-shu/1.nginxwang-zhan-fu-wu.html#_2-调整配置文件" class="sidebar-link">2. 调整配置文件</a></li><li class="sidebar-sub-header"><a href="/docs/nginx/03_lnmphuan-jing-bu-shu/1.nginxwang-zhan-fu-wu.html#_3-访问状态统计" class="sidebar-link">3. 访问状态统计</a></li><li class="sidebar-sub-header"><a href="/docs/nginx/03_lnmphuan-jing-bu-shu/1.nginxwang-zhan-fu-wu.html#_4-nginx访问控制" class="sidebar-link">4. Nginx访问控制</a></li><li class="sidebar-sub-header"><a href="/docs/nginx/03_lnmphuan-jing-bu-shu/1.nginxwang-zhan-fu-wu.html#_5-虚拟主机" class="sidebar-link">5. 虚拟主机</a></li></ul></li><li><a href="/docs/nginx/03_lnmphuan-jing-bu-shu/2.lnmphuan-jing-bu-shu.html" class="sidebar-link">LNMP环境部署</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Nginx优化管理</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>代码</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>收藏文章</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="nginx网站服务"><a href="#nginx网站服务" class="header-anchor">#</a> Nginx网站服务</h1> <p>本章节主要目的是配置Nginx成为一个网站server</p> <h2 id="_1-安装nginx"><a href="#_1-安装nginx" class="header-anchor">#</a> 1. 安装Nginx</h2> <p>yum安装或者编译安装均可以</p> <h2 id="_2-调整配置文件"><a href="#_2-调整配置文件" class="header-anchor">#</a> 2. 调整配置文件</h2> <p>在Nginx服务器的主配置文件/usr/local/nginx/conf/nginx.conf中，包括全局配置、I/O事件配置和HTTP配置这三大块内容，配置语句的格式为&quot;指令  值；&quot; (末尾以分号表示结束)，以 &quot; # &quot; 开始的部分表示注释。</p> <h3 id="_2-1-全局配置"><a href="#_2-1-全局配置" class="header-anchor">#</a> 2.1 全局配置</h3> <p>由各种配置语句组成，不使用特定的界定标记。全局配置部分包括Nginx服务的运行用户、工作进程数、错误日志、PID存放位置等基本设置。</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">user</span> nginx nginx</span><span class="token punctuation">;</span>	     	<span class="token comment"># 运行用户和组</span>
<span class="token directive"><span class="token keyword">worker_processes</span> auto</span><span class="token punctuation">;</span>	 	<span class="token comment"># 工作进程数量</span>
<span class="token directive"><span class="token keyword">worker_cpu_affinity</span> auto</span><span class="token punctuation">;</span>	<span class="token comment"># 工作进程自动绑定到特定CPU</span>
<span class="token directive"><span class="token keyword">worker_rlimit_nofile</span> <span class="token number">65535</span></span><span class="token punctuation">;</span> <span class="token comment"># 工作进程打开的最大文件数</span>

<span class="token directive"><span class="token keyword">error_log</span>  /var/log/nginx/error.log warn</span><span class="token punctuation">;</span>	<span class="token comment"># 错误日志位置</span>
<span class="token directive"><span class="token keyword">pid</span>        /var/run/nginx.pid</span><span class="token punctuation">;</span>			   <span class="token comment"># PID文件位置</span>
</code></pre></div><h3 id="_2-2-i-o事件配置"><a href="#_2-2-i-o事件配置" class="header-anchor">#</a> 2.2 I/O事件配置</h3> <p>使用&quot;events { }&quot;界定标记，用来指定Nginx进程的I/O响应模型、每个进程的连接数等设置。对于2.6及以上版本的内核,建议使用epoll模型以提高性能；每个进程的连接数应根据实际需要来定，一般在1000以下(默认为1024)。</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">use</span> epoll</span><span class="token punctuation">;</span>					<span class="token comment">#使用epoll模型</span>
    <span class="token directive"><span class="token keyword">worker_connections</span>  <span class="token number">8192</span></span><span class="token punctuation">;</span>	 <span class="token comment">#每进程处理8192个连接（默认为1024）</span>
<span class="token punctuation">}</span>
</code></pre></div><p>若工作进程数为4，每个进程处理8192个连接，则允许Nginx正常提供服务的连接数已超过3万个(8192*4=32768)，当然具体还要看服务器硬件、网络带宽等物理条件的性能表现。</p> <h3 id="_2-3-http配置"><a href="#_2-3-http配置" class="header-anchor">#</a> 2.3 HTTP配置</h3> <p>使用&quot;http { }&quot;界定标记，包括访问日志、HTTP端口、网页目录、默认字符集、连接保持，以及后面要讲到的虚拟Web主机、PHP解析等一系列设置， 其中大部分配置语句都包含在子界定标记&quot;server { }&quot;内。</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">include</span>       /etc/nginx/mime.types</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">default_type</span>  application/octet-stream</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">log_format</span>  main  <span class="token string">'<span class="token variable">$remote_addr</span> - <span class="token variable">$remote_user</span> [<span class="token variable">$time_local]</span> &quot;<span class="token variable">$request</span>&quot; '</span>
                      <span class="token string">'<span class="token variable">$status</span> <span class="token variable">$body_bytes_sent</span> &quot;<span class="token variable">$http_referer</span>&quot; '</span>
                      <span class="token string">'&quot;<span class="token variable">$http_user_agent</span>&quot; &quot;<span class="token variable">$http_x_forwarded_for</span>&quot;'</span></span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">access_log</span>  /var/log/nginx/access.log  main</span><span class="token punctuation">;</span>	<span class="token comment"># 访问日志位置</span>

    <span class="token directive"><span class="token keyword">sendfile</span>        <span class="token boolean">on</span></span><span class="token punctuation">;</span>			<span class="token comment"># 静态服务器时，开启大大提升性能</span>
    <span class="token comment">#tcp_nopush     on;</span>

	<span class="token comment">#keepalive_timeout  0;</span>
    <span class="token directive"><span class="token keyword">keepalive_timeout</span>  <span class="token number">65</span></span><span class="token punctuation">;</span>		<span class="token comment"># 连接保持超时事件</span>

    <span class="token comment">#gzip  on;</span>

	<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
		<span class="token directive"><span class="token keyword">listen</span>		<span class="token number">80</span></span><span class="token punctuation">;</span>		<span class="token comment"># 侦听地址</span>
		<span class="token directive"><span class="token keyword">server_name</span> www.shengzhe.com</span><span class="token punctuation">;</span>	<span class="token comment"># 网站域名</span>
		
		<span class="token directive"><span class="token keyword">charset</span> utf-8</span><span class="token punctuation">;</span>		<span class="token comment"># 网页的默认字符集</span>
		
		<span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>		<span class="token comment">#根目录配置</span>
			<span class="token directive"><span class="token keyword">root</span>	html</span><span class="token punctuation">;</span>	<span class="token comment">#根目录位置</span>
			<span class="token directive"><span class="token keyword">index</span>	index.html index.html</span><span class="token punctuation">;</span>	<span class="token comment"># 默认首页</span>
		<span class="token punctuation">}</span>
        
        <span class="token directive"><span class="token keyword">error_page</span>	<span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>	/50x.html</span><span class="token punctuation">;</span>	<span class="token comment"># 内部错误的反馈页面</span>
        <span class="token directive"><span class="token keyword">location</span> = /50x.html</span> <span class="token punctuation">{</span>	<span class="token comment">#错误页面的配置</span>
            <span class="token directive"><span class="token keyword">root</span> html</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上述配置中，listen语句允许同时限定IP地址，采用&quot;IP地址：端口形式；root 语句用来设置特定访问位置(如&quot;location/&quot;表示根目录)的网页文档路径，默认为Nginx安装目录下的html/子目录，根据需要可改为/var/ww/html等其他路径。</p> <h2 id="_3-访问状态统计"><a href="#_3-访问状态统计" class="header-anchor">#</a> 3. 访问状态统计</h2> <p>Nginx内置了HTTP_ STUB_ STATUS状态统计模块，用来反馈当前的Web访问情况，配置编译参数时可添加 --with-http_stub_ status_module 来启用此模块支持，可以使用命令 <code>$ nginx /usr/local/nginx/sbin/nginx -V</code>查看已安装的Nginx是否包含HTTP STUB _STATUS模块( 或者使用命令<code>$ nginx -V</code> 查看已安装的模块)。</p> <p>要使用Nginx的状态统计功能，除了启用内建模块以外，还需要修改nginx.conf配置文件，指定访问位置并添加stub_ status配置代码。</p> <p>（yum安装配置文件在<code>/etc/nginx/conf.d</code>目录下）</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>  localhost</span><span class="token punctuation">;</span>

    <span class="token comment">#charset koi8-r;</span>
    <span class="token comment">#access_log  /var/log/nginx/host.access.log  main;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span>   /usr/share/nginx/html</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">index</span>  index.html index.htm</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">#error_page  404              /404.html;</span>

    <span class="token comment"># redirect server error pages to the static page /50x.html</span>
    <span class="token comment">#</span>
    <span class="token directive"><span class="token keyword">error_page</span>   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> = /50x.html</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span>   /usr/share/nginx/html</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">location</span> /status</span> <span class="token punctuation">{</span>	<span class="token comment">#访问位置为/status</span>
        <span class="token directive"><span class="token keyword">stub_status</span></span><span class="token punctuation">;</span>	<span class="token comment">#打开状态统计功能</span>
        <span class="token directive"><span class="token keyword">access_log</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>  <span class="token comment">#关闭此位置的日志记录</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>新的配置生效以后，在浏览器中访问Nginx服务器的/status网站位置，可以看到当前的状态统计信息：</p> <p><img src="images/image-20200414202324409.png" alt="image-20200414202324409"></p> <h2 id="_4-nginx访问控制"><a href="#_4-nginx访问控制" class="header-anchor">#</a> 4. Nginx访问控制</h2> <h3 id="_4-1-基于授权的访问控制"><a href="#_4-1-基于授权的访问控制" class="header-anchor">#</a> 4.1 基于授权的访问控制</h3> <p>Nginx可以实现基于用户授权的访问控制，当客户端想要访问相应网站或者目录时，要求用户输入用户名和密码才能正常访问，配置步骤如下：</p> <ol><li>生成用户密码认证文件。</li> <li>修改配置文件相对应目录，添加认证配置项。</li> <li>启动服务，访问测试。</li></ol> <ul><li><p>使用htpasswd生成用户认证文件，如果没有该命令，可使用yum安装httpd-tools软件包。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ yum <span class="token function">install</span> httpd-tools -y
$ htpasswd -c passwd.db <span class="token builtin class-name">test</span>
New password: 
Re-type new password: 
Adding password <span class="token keyword">for</span> user <span class="token builtin class-name">test</span>
$ <span class="token function">cat</span> passwd.db
test:<span class="token variable">$apr1</span><span class="token variable">$sgQpKECK</span><span class="token variable">$MVHuob9Qgj53nK6RNXoaf</span><span class="token builtin class-name">.</span>
</code></pre></div></li> <li><p>修改密码文件的权限为400，将所有者改为www，设置nginx的运行用户能够读取。</p> <div class="language-shell extra-class"><pre class="language-shell"><code> $ <span class="token function">chmod</span> <span class="token number">400</span> passwd.db 
 $ <span class="token function">chown</span> www passwd.db 
 $ <span class="token function">ls</span> -l passwd.db 
-r--------. <span class="token number">1</span> www root <span class="token number">43</span> Apr <span class="token number">14</span> 08:34 passwd.db
</code></pre></div></li> <li><p>修改主配置文件nginx.conf，添加相应认证配置项。</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /status</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">stub_status</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">access_log</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">auth_basic</span> <span class="token string">&quot;admin&quot;</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">auth_basic_user_file</span> /etc/nginx/conf.d/passwd.db</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div></li> <li><p>检查语法，重启服务。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ nginx -t
nginx: the configuration <span class="token function">file</span> /etc/nginx/nginx.conf syntax is ok
nginx: configuration <span class="token function">file</span> /etc/nginx/nginx.conf <span class="token builtin class-name">test</span> is successful
$ systemctl restart nginx
</code></pre></div></li> <li><p>用浏览器访问网址，检验控制效果，如图所示：</p> <p><img src="https://pic-onemue-cn.oss-cn-beijing.aliyuncs.com/docs/onemue1647249916GsE8lp.png" alt="image-20200414210430974"></p> <p>需要输入用户名和密码进行访问，验证通过才能访问到页面。</p></li></ul> <h3 id="_4-2-基于客户端的访问控制"><a href="#_4-2-基于客户端的访问控制" class="header-anchor">#</a> 4.2 基于客户端的访问控制</h3> <p>基于客户端的访问控制是通过客户端IP地址，决定是否允许对页面访问。Nginx基于客户端的访问控制规则如下：</p> <ol><li>denyIP/IP段：拒绝某个IP或IP段的客户端访问。</li> <li>allowIP/IP段：允许某个IP或IP段的客户端访问。</li> <li>规则从上往下执行，如匹配则停止，不再往下匹配。</li></ol> <ul><li><p>修改主配置文件nginx.conf，添加相应配置项</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> = /basic_status</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">stub_status</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">deny</span> 192.168.57.1</span><span class="token punctuation">;</span>		    <span class="token comment">#拒绝这个地址</span>
        <span class="token directive"><span class="token keyword">allow</span> 192.168.87.0/24</span><span class="token punctuation">;</span>		<span class="token comment">#允许这个网段</span>
        <span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span>				   <span class="token comment">#拒绝所有其他地址</span>
    <span class="token punctuation">}</span>
</code></pre></div></li> <li><p>重启服务</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ nginx -t
nginx: the configuration <span class="token function">file</span> /etc/nginx/nginx.conf syntax is ok
nginx: configuration <span class="token function">file</span> /etc/nginx/nginx.conf <span class="token builtin class-name">test</span> is successful
$ systemctl restart nginx
</code></pre></div></li> <li><p>使用 192.168.57.1地址访问，不能访问，其他地址可以</p> <p><img src="https://pic-onemue-cn.oss-cn-beijing.aliyuncs.com/docs/onemue16472499225MSx3T.png" alt="image-20200414211550437"></p></li></ul> <h2 id="_5-虚拟主机"><a href="#_5-虚拟主机" class="header-anchor">#</a> 5. 虚拟主机</h2> <p>利用虚拟主机，不用为每个要运行的网站提供-台单独的Nginx服务器或单独运行一组Nginx进程，虚拟主机提供了在同一台服务器，同一组Nginx进程上运行多个网站的功能。Nginx可以配置多种类型的虚拟主机，分别是基于IP的虚拟主机、基于域名的虚拟主机、基于端口的虚拟主机。</p> <p>使用Nginx搭建虚拟主机服务器时，每个虚拟Web站点拥有独立的&quot;server{ }&quot;配置段，各自监听的IP地址、端口号可以单独指定，当然网站名称也是不同的。</p> <h3 id="_5-1-基于域名的虚拟主机-使用的最多"><a href="#_5-1-基于域名的虚拟主机-使用的最多" class="header-anchor">#</a> 5.1 基于域名的虚拟主机 (使用的最多)</h3> <p>配置文件案例：</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>			<span class="token comment"># 加入 www.bt.com</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> www.bt.com</span><span class="token punctuation">;</span>		<span class="token comment"># 监听域名</span>
    <span class="token directive"><span class="token keyword">charset</span> utf-8</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">access_log</span> logs/www.bt.access.log</span><span class="token punctuation">;</span>	<span class="token comment"># 日志文件</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span> /var/www/html/btcom</span><span class="token punctuation">;</span>	<span class="token comment"># www.bt.com 的工作目录</span>
        <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token directive"><span class="token keyword">error_page</span> <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span> /50x.html</span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">location</span> = 50x.html</span> <span class="token punctuation">{</span>
		<span class="token directive"><span class="token keyword">root</span> html</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>			<span class="token comment"># 加入 www.test.com 对应的站点</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> www.test.com</span><span class="token punctuation">;</span>		<span class="token comment"># 监听域名</span>
    <span class="token directive"><span class="token keyword">charset</span> utf-8</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">access_log</span> logs/www.test.access.log</span><span class="token punctuation">;</span>	<span class="token comment"># 日志文件</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span> /var/www/html/testcom</span><span class="token punctuation">;</span>	<span class="token comment"># www.test.com 的工作目录</span>
        <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token directive"><span class="token keyword">error_page</span> <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span> /50x.html</span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">location</span> = 50x.html</span> <span class="token punctuation">{</span>
		<span class="token directive"><span class="token keyword">root</span> html</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>首先建立2个网站的根目录</li> <li>修改配置文件如上</li> <li>客户端使用域名访问验证即可</li></ul> <h3 id="_5-2-基于ip的虚拟主机"><a href="#_5-2-基于ip的虚拟主机" class="header-anchor">#</a> 5.2 基于ip的虚拟主机</h3> <p>配置文件案例：</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
	<span class="token directive"><span class="token keyword">listen</span> 192.168.9.158:80</span><span class="token punctuation">;</span>	<span class="token comment"># 监听 192.168.9.158</span>
	<span class="token directive"><span class="token keyword">server_name</span> 192.168.9.158:80</span><span class="token punctuation">;</span>
	................ <span class="token comment"># 省略内容</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
	<span class="token directive"><span class="token keyword">listen</span> 192.168.9.110:80</span><span class="token punctuation">;</span>	<span class="token comment"># 监听 192.168.9.110</span>
	<span class="token directive"><span class="token keyword">server_name</span> 192.168.9.110:80</span><span class="token punctuation">;</span>
	................ <span class="token comment"># 省略内容</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>首先给服务器配置2个不同的IP地址</li> <li>修改配置文件如上</li> <li>客户端访问测试即可</li></ul> <h3 id="_5-3-基于端口的虚拟主机"><a href="#_5-3-基于端口的虚拟主机" class="header-anchor">#</a> 5.3 基于端口的虚拟主机</h3> <p>配置文件案例：</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
	<span class="token directive"><span class="token keyword">listen</span> 192.168.9.158:6666</span><span class="token punctuation">;</span>	<span class="token comment"># 监听 6666 端口</span>
	<span class="token directive"><span class="token keyword">server_name</span> 192.168.9.158:6666</span><span class="token punctuation">;</span>	<span class="token comment"># 域名也可</span>
	................ <span class="token comment"># 省略内容</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
	<span class="token directive"><span class="token keyword">listen</span> 192.168.9.158:8888</span><span class="token punctuation">;</span>	<span class="token comment"># 监听 8888 端口</span>
	<span class="token directive"><span class="token keyword">server_name</span> 192.168.9.158:8888</span><span class="token punctuation">;</span>	<span class="token comment"># 域名也可</span>
	................ <span class="token comment"># 省略内容</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>修改配置文件</li> <li>防火墙放行以上端口</li> <li>客户端使用不同的端口进行测试即可</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/nginx/02_nginxmo-kuai-guan-li/nginxchang-yong-mo-kuai-03.html" class="prev">
        Nginx常用模块三
      </a></span> <span class="next"><a href="/docs/nginx/03_lnmphuan-jing-bu-shu/2.lnmphuan-jing-bu-shu.html">
        LNMP环境部署
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.27b283a1.js" defer></script><script src="/docs/assets/js/2.2e8f894a.js" defer></script><script src="/docs/assets/js/14.4f6283b3.js" defer></script>
  </body>
</html>
