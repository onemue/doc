<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nginx优化及防盗链 | ONEMUE Docs</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="This is a Docs.">
    
    <link rel="preload" href="/docs/assets/css/0.styles.90a57e95.css" as="style"><link rel="preload" href="/docs/assets/js/app.27b283a1.js" as="script"><link rel="preload" href="/docs/assets/js/2.2e8f894a.js" as="script"><link rel="preload" href="/docs/assets/js/16.5dfc5cc5.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.f6f629b0.js"><link rel="prefetch" href="/docs/assets/js/11.84b24849.js"><link rel="prefetch" href="/docs/assets/js/12.76af45bb.js"><link rel="prefetch" href="/docs/assets/js/13.c0ae4be6.js"><link rel="prefetch" href="/docs/assets/js/14.4f6283b3.js"><link rel="prefetch" href="/docs/assets/js/15.002291f6.js"><link rel="prefetch" href="/docs/assets/js/17.14f17db6.js"><link rel="prefetch" href="/docs/assets/js/18.971e9caa.js"><link rel="prefetch" href="/docs/assets/js/19.889fb802.js"><link rel="prefetch" href="/docs/assets/js/20.d1be27fd.js"><link rel="prefetch" href="/docs/assets/js/21.83fd3971.js"><link rel="prefetch" href="/docs/assets/js/22.6bc785a8.js"><link rel="prefetch" href="/docs/assets/js/23.c9474e02.js"><link rel="prefetch" href="/docs/assets/js/24.054109cd.js"><link rel="prefetch" href="/docs/assets/js/25.c7f91c21.js"><link rel="prefetch" href="/docs/assets/js/3.ea118fbe.js"><link rel="prefetch" href="/docs/assets/js/4.6fbf7596.js"><link rel="prefetch" href="/docs/assets/js/5.f7d53cbe.js"><link rel="prefetch" href="/docs/assets/js/6.db4bfcd5.js"><link rel="prefetch" href="/docs/assets/js/7.2123913f.js"><link rel="prefetch" href="/docs/assets/js/8.c52818c0.js"><link rel="prefetch" href="/docs/assets/js/9.20e728b8.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.90a57e95.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">ONEMUE Docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/docs/" aria-current="page" class="sidebar-link">内容构建中</a></li><li><a href="/docs/unicloud.html" class="sidebar-link">出现两年的 uniCloud</a></li><li><a href="/docs/han-shu-de-yi-xie-yan-jiu.html" class="sidebar-link">/han-shu-de-yi-xie-yan-jiu.html</a></li><li><a href="/docs/mian-shi.html" class="sidebar-link">面试汇总</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java Script</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Nginx</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Nginx安装及配置</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Nginx模块管理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>LNMP环境部署</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Nginx优化管理</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/nginx/04_nginxyou-hua-guan-li/1.-nginxyou-hua-ji-fang-dao-lian/nginxyou-hua-ji-fang-dao-lian.html" aria-current="page" class="active sidebar-link">Nginx优化及防盗链</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/nginx/04_nginxyou-hua-guan-li/1.-nginxyou-hua-ji-fang-dao-lian/nginxyou-hua-ji-fang-dao-lian.html#_1、隐藏版本等信息" class="sidebar-link">1、隐藏版本等信息</a></li><li class="sidebar-sub-header"><a href="/docs/nginx/04_nginxyou-hua-guan-li/1.-nginxyou-hua-ji-fang-dao-lian/nginxyou-hua-ji-fang-dao-lian.html#_2、工作进程数优化" class="sidebar-link">2、工作进程数优化</a></li><li class="sidebar-sub-header"><a href="/docs/nginx/04_nginxyou-hua-guan-li/1.-nginxyou-hua-ji-fang-dao-lian/nginxyou-hua-ji-fang-dao-lian.html#_3、nginx事件处理模型" class="sidebar-link">3、Nginx事件处理模型</a></li><li class="sidebar-sub-header"><a href="/docs/nginx/04_nginxyou-hua-guan-li/1.-nginxyou-hua-ji-fang-dao-lian/nginxyou-hua-ji-fang-dao-lian.html#_4、开启高效传输模式" class="sidebar-link">4、开启高效传输模式</a></li><li class="sidebar-sub-header"><a href="/docs/nginx/04_nginxyou-hua-guan-li/1.-nginxyou-hua-ji-fang-dao-lian/nginxyou-hua-ji-fang-dao-lian.html#_5、连接超时时间" class="sidebar-link">5、连接超时时间</a></li><li class="sidebar-sub-header"><a href="/docs/nginx/04_nginxyou-hua-guan-li/1.-nginxyou-hua-ji-fang-dao-lian/nginxyou-hua-ji-fang-dao-lian.html#_6、fastcgi调优" class="sidebar-link">6、fastcgi调优</a></li><li class="sidebar-sub-header"><a href="/docs/nginx/04_nginxyou-hua-guan-li/1.-nginxyou-hua-ji-fang-dao-lian/nginxyou-hua-ji-fang-dao-lian.html#_7、gzip调优" class="sidebar-link">7、gzip调优</a></li><li class="sidebar-sub-header"><a href="/docs/nginx/04_nginxyou-hua-guan-li/1.-nginxyou-hua-ji-fang-dao-lian/nginxyou-hua-ji-fang-dao-lian.html#_8、配置网页缓存时间" class="sidebar-link">8、配置网页缓存时间</a></li><li class="sidebar-sub-header"><a href="/docs/nginx/04_nginxyou-hua-guan-li/1.-nginxyou-hua-ji-fang-dao-lian/nginxyou-hua-ji-fang-dao-lian.html#_9、防盗链" class="sidebar-link">9、防盗链</a></li><li class="sidebar-sub-header"><a href="/docs/nginx/04_nginxyou-hua-guan-li/1.-nginxyou-hua-ji-fang-dao-lian/nginxyou-hua-ji-fang-dao-lian.html#_10、内核参数优化" class="sidebar-link">10、内核参数优化</a></li></ul></li><li><a href="/docs/nginx/04_nginxyou-hua-guan-li/2.-nginx-rewrite/nginx-rewrite.html" class="sidebar-link">Nginx Rewrite</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>代码</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>收藏文章</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="nginx优化及防盗链"><a href="#nginx优化及防盗链" class="header-anchor">#</a> Nginx优化及防盗链</h1> <p>​    在企业信息化应用环境中，服务器的安全性和响应速度需要根据实际情况进行相应参数配置,以达到最优的用户体验。默认的Nginx安装参数只能提供最基本的服务，需要调整如网页缓存时间、连接超时、网页压缩等相应参数，发挥出服务器的最大作用。</p> <h2 id="_1、隐藏版本等信息"><a href="#_1、隐藏版本等信息" class="header-anchor">#</a> 1、隐藏版本等信息</h2> <p>在生产环境中，需要隐藏Nginx的版本号， 以避免泄漏Nginx的版本， 使攻击者不能针对特定版本进行攻击。
优化前访问:</p> <div class="language-http extra-class"><pre class="language-http"><code><span class="token response-status"><span class="token http-version property">HTTP/1.1</span> <span class="token status-code number">200</span> <span class="token reason-phrase string">OK</span></span>
<span class="token header"><span class="token header-name keyword">server</span><span class="token punctuation">:</span> <span class="token header-value">nginx/1.16.0	#版本信息</span></span>
<span class="token header"><span class="token header-name keyword">Date</span><span class="token punctuation">:</span> <span class="token header-value">Thu, 04 Jul 2019 15:06:57 GMT</span></span>
<span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">text/html; charset=utf-8</span></span>
<span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">626</span></span>
<span class="token header"><span class="token header-name keyword">Last-Modified</span><span class="token punctuation">:</span> <span class="token header-value">Mon， 01 Jul 2019 09:26:46 GMT</span></span>
<span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">keep-alive</span></span>
<span class="token header"><span class="token header-name keyword">ETag</span><span class="token punctuation">:</span> <span class="token header-value">&quot;5d19d1d6-272&quot;</span></span>
<span class="token header"><span class="token header-name keyword">Accept-Ranges</span><span class="token punctuation">:</span> <span class="token header-value">bytes</span></span>
</code></pre></div><h3 id="优化方式"><a href="#优化方式" class="header-anchor">#</a> 优化方式</h3> <ul><li><p>修改主配置文件</p> <p>将Nginx的配置文件中的server_tokens选项值设置为off,如没有该配置项,加上即可。</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
<span class="token directive"><span class="token keyword">include</span>		 mime.types</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">default_type</span> application/octet-stream</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">server_tokens</span> <span class="token boolean">off</span></span> <span class="token punctuation">;</span>
…………	<span class="token comment">#省略很多内容</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <p>使用了php处理动态网页,如果php配置文件中配置了fastcgi_param SERVER_SOFTWARE选项,则编辑php-fpm配置文件，将fastcgi_param SERVER_SOFTWARE对应的值修改为fastcgi_param SERVER_SOFTWARE nginx。</p> <p>重启服务后，再次查看：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>  $ <span class="token function">curl</span> -I http://127.0.0.1
  HTTP/1.1 <span class="token number">200</span> OK
  Server: nginx
  Date: Tue, <span class="token number">21</span> Apr <span class="token number">2020</span> <span class="token number">14</span>:35:15 GMT
  Content-Type: text/html
  Content-Length: <span class="token number">612</span>
  Last-Modified: Tue, <span class="token number">21</span> Apr <span class="token number">2020</span> <span class="token number">13</span>:35:13 GMT
  Connection: keep-alive
  ETag: <span class="token string">&quot;5e9ef691-264&quot;</span>
  Accept-Ranges: bytes
</code></pre></div><ul><li><p><strong>编译安装前修改源码</strong></p> <p>编译前的优化主要是用来修改程序名等等，目的更改源码隐藏软件名称和版本号。</p> <p>1.进入解压后的源码目录,进行修改</p> <p>​	修改前</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">vim</span> src/core/nginx.h
<span class="token comment">#define NGINX_VERSION	   &quot;1.16.0&quot;	  #定义的版本号</span>
<span class="token comment">#define NGINX_VER		  &quot;nginx/&quot; NGINX_VERSION  #定义的软件名称</span>
</code></pre></div><p>​	修改后</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">vim</span> src/core/nginx.h
<span class="token comment">#define NGINX_VERSION		&quot;7.0&quot;</span>
<span class="token comment">#define NGINX_VER			&quot;IIS/&quot; NGINX_VERSION</span>
</code></pre></div><p>2、修改HTTP头信息中的connection字段，防止回显具体版本号</p> <p>拓展:通用http头,通用头包含请求和响应消息都支持的头，通用头包含Cache-Control、Connection、Date、 Pragma、 Transfer-Encoding、 Upgrade、 Via。 对通用头的扩展要求通讯双方都支持此扩展，如果存在不支持的通用头, 一般将会作为实体头处理。那么也就是说有部分设备或者是软件能获取到connection， 要隐藏就要彻底!</p> <p>​	修改前：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">vim</span> src/core/nginx.h
static u_char ngx_http_error_tail<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>
<span class="token string">&quot;&lt;hr&gt;&lt;center&gt;nginx&lt;/center&gt;&quot;</span> CRLF
<span class="token string">&quot;&lt;/body&gt;&quot;</span> CRLF
'<span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span>&quot; CRLF
<span class="token punctuation">;</span>
</code></pre></div></li></ul> <p>修改后：</p> <div class="language-html extra-class"><pre class="language-html"><code>  static u_char ngx_http_error_tail[] =
  &quot;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>center</span><span class="token punctuation">&gt;</span></span>IIS<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>center</span><span class="token punctuation">&gt;</span></span>&quot; CRLF
  &quot;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>&quot; CRLF
  &quot;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>&quot; CRLF
  ;
</code></pre></div><p>修改完毕后进行编译安装，安装完成后,查看测试:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>  $ <span class="token function">curl</span> -I http://127.0.0.1
  HTTP/1.1 <span class="token number">200</span> OK
  Server: IIS/7.0 
  …………		<span class="token comment">#省略很多内容</span>
</code></pre></div><h2 id="_2、工作进程数优化"><a href="#_2、工作进程数优化" class="header-anchor">#</a> 2、工作进程数优化</h2> <p>Nginx默认只开启一个worker进程， 一般都设置为CPU个数，查看CPU个数使用如下命令:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">grep</span> -C <span class="token string">'processor'</span> /proc/cpuinfo
<span class="token number">4</span>
</code></pre></div><p>所以应该配置成：</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">worker_processes</span> <span class="token number">4</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">worker_cpu_affinity</span> <span class="token number">0001</span> <span class="token number">0010</span> <span class="token number">0100</span> <span class="token number">1000</span></span><span class="token punctuation">;</span> <span class="token comment">#将每个工作进程绑定到单独的CPU</span>
<span class="token directive"><span class="token keyword">worker_rlimit_nofile</span> <span class="token number">65535</span></span><span class="token punctuation">;</span> <span class="token comment">#工作进程打开的最大文件数</span>
</code></pre></div><p>也可以这样调整(1.9.0版本后)</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">worker_processes</span> auto</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">worker_cpu_affinity</span> auto</span><span class="token punctuation">;</span>
<span class="token comment">#1.9.10版本后允许将工作进程自动绑定到可用的CPU</span>
</code></pre></div><p>打开的最大文件数还要和系统的一致，使用ulimit -n查看，如果不一致,需要调整</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">vim</span> /etc/security/limits.conf
* soft nofile <span class="token number">65535</span>
* hard nofile <span class="token number">65535</span>
* soft noproc <span class="token number">65535</span>
* hard noproc <span class="token number">65535</span>
</code></pre></div><h2 id="_3、nginx事件处理模型"><a href="#_3、nginx事件处理模型" class="header-anchor">#</a> 3、Nginx事件处理模型</h2> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">{</span>
	<span class="token directive"><span class="token keyword">use</span> epoll</span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">worker_connections</span> <span class="token number">8192</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">accept_mutex</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">multi_accept</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>nginx采用epolI事件模型，处理效率高。</p> <p>work_connections是单个worker进程允许客户端最大连接数,这个数值一般根据服务器性能和内存来制定，实际最大值就是worker进程数乘以work_connections</p> <p>accept_mutex（ [əkˈsept]  //,mjuː ˈtɛks//）如果启用on,工作进程将轮流接受新的连接。否则，将通知所有工作进程有关新连接的信息,但只有一个进程可以获得连接。如果新连接的数量较低，则某些工作进程可能会浪费系统资源。如果是并发连接数很大的情况，应该调整为off.新版本默认是off,在版本1.1 1.3之前，默认值为on。</p> <p>multi_accept指令使得NGINX worker能够在获得新连接的通知时尽可能多的接受连接。此指令的作用是立即接受所有连接放到监听队列中。如果指令被禁用, worker进程将逐个接受连接。默认是off。</p> <h2 id="_4、开启高效传输模式"><a href="#_4、开启高效传输模式" class="header-anchor">#</a> 4、开启高效传输模式</h2> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
	<span class="token directive"><span class="token keyword">include</span>			mime.types</span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">default_type</span> 	application/octet-stream</span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">sendfile</span>		<span class="token boolean">on</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">tcp_nopush</span>		<span class="token boolean">on</span></span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre></div><p>include mime.types; //媒体类型,include只是一个在当前文件中包含另一个文件内容的指令。
default_type application/octet-stream;  //默认媒体类型</p> <p>sendfile on; //开启高效文件传输模式，sendfile指令指定nginx是否调用sendfile函数来输出文件，对于普通应用设为on,如果用来进行下载等应用磁盘I/0重负载应用，可设置为off, 以平衡磁盘与网络I/O处理速度，降低系统的负载。注意:如果图片显示不正常把这个改成off。当Nginx是一个静态文件服务器的时候，开启sendfile配置项能大大提高Nginx的性能。</p> <p>tcp_nopush on;必须在sendfile开启模式才有效,防止网路阻塞,积极的减少网络报文段的数量(告诉nginx在一个数据包里发送所有头文件,而不是一个接一个的发送。 同tcp_nodelay选项互斥)</p> <h2 id="_5、连接超时时间"><a href="#_5、连接超时时间" class="header-anchor">#</a> 5、连接超时时间</h2> <p>主要目的是保护服务器资源，CPU,内存,控制连接数，因为建立连接也是需要消耗资源的</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">keepalive_timeout</span> <span class="token number">60</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">tcp_nodelay</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">client_header_buffer_size</span> <span class="token number">4k</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">open_file_cache</span> max=102400 inactive=20s</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">open_file_cache_valid</span> <span class="token number">30s</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">open_file_cache_min_uses</span> <span class="token number">1</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">client_header_timeout</span> <span class="token number">15</span></span> <span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">client_body_timeout</span> <span class="token number">15</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">reset_timedout_connection</span> <span class="token boolean">on</span></span> <span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">send_timeout</span> <span class="token number">15</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">server_tokens</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">client_max_body_size</span> <span class="token number">10m</span></span><span class="token punctuation">;</span>
</code></pre></div><p>keepalived_timeout客户端连接保持会话超时时间,超过这个时间，服务器断开这个链接</p> <p>tcp_nodelay off,会增加通信的延时,但是会提高带宽利用率。在高延时、数据量大的通信场景中应该会有不错的效果;tcp_nodelay on,会增加小包的数量,但是可以提高响应速度。在及时性高的通信场景中应该会有不错的效果;</p> <p>client_header_buffer_size 4k;
客户端请求头部的缓冲区大小，这个可以根据你的系统分页大小来设置，一般一个请求头的大小不会超过1k,不过由于一般系统分页都要大于1k, 所以这里设置为分页大小。分页大小可以用命令getconf PAGESIZE取得。</p> <p>open_file_cache max=102400 inactive=20s;
这个将为打开文件指定缓存，默认是没有启用的，max指定缓存数量,建议和打开文件数一致，inactive是指经过多长时间文件没被请求后删除缓存。</p> <p>open_file_cache_valid 30s;这个是指多长时间检查一次缓存的有效信息。
open_file_cache_min_uses 1;open_file_cache 指令中的inactive参数时间内文件的最少使用次数，如果超过这个数字，文件描述符一直是在缓存中打开的，如上例，如果有一个文件在inactive时间内一次没被使用，它将被移除</p> <p>client_header_timeout设置请求头的超时时间。我们也可以把这个设置低些，如果超过这个时间没有发送任何数据，nginx将返回request time out的错误</p> <p>client_body_timeout设置请求体的超时时间。我们也可以把这个设置低些，超过这个时间没有发送任何数据，和上面一样的错误提示</p> <p>reset_timeout_connection 告诉nginx关闭不响应的客户端连接。这将会释放那个客户端所占有的内存空间。</p> <p>send_timeout响应客户端超时时间，这个超时时间仅限于两个活动之间的时间，如果超过这个时间，客户端没有任何活动，nginx 关闭连接</p> <p>client_max_body_size.上传文件大小限制。</p> <h2 id="_6、fastcgi调优"><a href="#_6、fastcgi调优" class="header-anchor">#</a> 6、fastcgi调优</h2> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">fastcgi_connect_timeout</span> <span class="token number">600</span></span> <span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">fastcgi_send_timeout</span> <span class="token number">600</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">fastcgi_read_timeout</span> <span class="token number">600</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">fastcgi_buffer_size</span> <span class="token number">64k</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">fastcgi_buffers</span> <span class="token number">4</span> <span class="token number">64k</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">fastcgi_busy_buffers_size</span> <span class="token number">128k</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">fastcgi_temp_file_write_size</span> <span class="token number">128k</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">fastcgi_temp_path</span> /usr/local/nginx1.10/nginx_tmp</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">fastcgi_intercept_errors</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">fastcgi_cache_path</span> /usr/1ocal/nginx1.10/fastcgi_cache levels=1:2
keys_zone=cache_fastcgi:128m
inactive=1d max_size=10g</span><span class="token punctuation">;</span>
</code></pre></div><p>fastcgi_connect_timeout 600; #指定连接到后端FastCGI的超时时间。
fastcgi_send_timeout 600; #向FastCGl传送请求的超时时间。
fastcgi_read_timeout 600; #指定接收FastCGI应答的超时时间。
fastcgi_buffer_size 64k; #指定读取FastCGI应答第一部分需要用多大的缓冲区，默认的缓冲区大小为一个内存页大小(4K或者8K)，可以将这个值设置更小。</p> <p>fastcgi_buffers 4 64k; #指定本地需要用多少和多大的缓冲区来缓冲FastCGl的应答请求,如果一个php脚本所产生的页面大小为256KB,那么会分配4个64KB的缓冲区来缓存,如果页面大小大于256KB,那么大于256KB的部分会缓存到fastcgi_temp_path指定的路径中，但是这并不是好方法,因为内存中的数据处理速度要快于磁盘。一般这个值应该为站点中 php脚本所产生的页面大小的中间值，如果站点大部分脚本所生的页面大小为256KB,那么可以把这个值设置为“8 32K&quot;、“4 64k”等。</p> <p>fastcgi_busy_buffers_size 128k; #建议设置为fastcgi_buffers的两倍，繁忙时候的buffer</p> <p>fastcgi_temp_file_write_size 128k; #在写入fastcgi_temp_path 时将用多大的数据块，默认值是fastcgi_ buffers的两倍,该数值设置过小时若负载上来时可能报502 Bad Gateway</p> <p>fastcgi_temp_path #缓存临时目录</p> <p>fastcgi_intercept_errors on;#这个指令指定是否传递4xx和5xx错误信息到客户端，或者允许nginx使用error_page处理错误信息。注:静态文件不存在会返回404页面，但是php页面则返回空白页!</p> <p>fastcgi_cache_path /usr/local/nginx1.1 0/fastcgi_cache levels=1:2 keys_zone=cache_fastcgi:128m
inactive=1d.max_size=10g; # fastcgi_cache 缓存目录，可以设置目录层级，比如1:2会生成16*256个子目录，cache_fastcgi 是这个缓存空间的名字，cache 是用多少内存(这样热门的内容nginx直接放内存，提高访问速度)，inactive表示默认失效时间，如果缓存数据在失效时间内没有被访问，将被删除，max_size 表示最多用多少硬盘空间。</p> <p>fastcgi_cache cache_fastcgi; #表示开启FastCGI缓存并为其指定一个名称。开启缓存非常有用，可以有效降低CPU的负载，并且防止502的错误发生。cache_fastcgi为proxy_cache_path指令创建的缓存区名称</p> <p>fastcgi_cache_valid 200 302 1h;#用来指定应答代码的缓存时间,实例中的值表示将200和302应答缓存一小时，要和fastcgi. cache配合使用</p> <p>fastcgi_cache. valid 301 1d; #将301应答缓存一天</p> <p>fastcgi_cache_valid any 1m; #将其他应答缓存为1分钟
fastcgi_cache_min_uses 1; #该指令用于设置经过多少次请求的相同URL将被缓存。
fastcgi_cache_key http://$host$request_uri; #该指令用来设置web缓存的Key值,nginx根据Key值md5哈希存储,一-般根据$host(域名)、$request_uri(请求的路径)等变量组合成proxy_cache_key</p> <p><strong>总结：</strong></p> <p>nginx的缓存功能有: proxy_cache和fastcgi_cache</p> <ul><li><p>proxy_cache的作用是缓存后端服务器的内容,可能是任何内容,包括静态的和动态。</p></li> <li><p>fastcgi_cache的作用是缓存fastcgj生成的内容，很多情况是php生成的动态的内容。</p></li> <li><p>proxy_cache缓存减少了nginx与后端通信的次数，节省了传输时间和后端宽带。</p></li> <li><p>fastcgi_cache缓存减少了nginx与php的通信的次数， 更减轻了php和数据库(mysql)的压力。</p></li></ul> <h2 id="_7、gzip调优"><a href="#_7、gzip调优" class="header-anchor">#</a> 7、gzip调优</h2> <p>使用gzip压缩功能，可节约带宽，加快传输速度,有更好的体验,也为我们节约成本,所以说这是一个重点。Nginx启用压缩功能需要你来ngx_http_gzip_module模块，apache使用的是mod_deflate. 一般我们需要压缩的内容有:文本，js, html, Css, 对于图片,视频，flash什么的不压缩，同时也要注意,使用gzip的功能是需要消耗CPU的。</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">gzip</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_min_length</span> <span class="token number">2k</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_buffers</span> <span class="token number">4</span> <span class="token number">32k</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_http_version</span> 1.1</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_comp_level</span> <span class="token number">6</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_types</span> text/plain text/css text/javascript application/json
application/javascript
application/x-javascript application/xml</span><span class="token punctuation">;</span>gzip_vary <span class="token directive"><span class="token keyword">on</span></span><span class="token punctuation">;</span> 
<span class="token directive"><span class="token keyword">gzip_proxied</span> any</span><span class="token punctuation">;</span>
</code></pre></div><p>gzip on; #开启压缩功能
gzip_min_length 1k; #设置允许压缩的页面最小字节数，页面字节数从header头的Content-Length中获取，默认值是20字节,建议设置成大于1K,如果小于1 K可能会越压越大。</p> <p>gzip_buffers 4 32k; #压缩缓冲区大小,表示申请4个单位为32K的内存作为压缩结果流缓存,默认值是申请与原始数据大小相同的内存空间来存储gzip压缩结果。</p> <p>gzip_http_version 1.1; #压缩版本，用于设置识别HTTP协议版本,默认是1.1,目前大部分浏览器已经支持GZIP解压，使用默认即可</p> <p>gzip_comp_level 6; #压缩比例，用来指定GZIP压缩比，1压缩比最小，处理速度最快，9压缩比最大,传输速度快，但是处理慢，也比较消耗CPU资源。默认是1</p> <p>gzip_types text/css text/xml application/javascript; #用来指定压缩的类型，'text/html类型总是会被压缩。默认值: gzip_types text/html (默认不对js/CSS文件进行压缩)</p> <p>gzip_vary on;开启和关闭插入&quot;Vary: Accept-Encoding&quot;响应头区域</p> <p>gzip_proxied any; #Nginx作为反向代理的时候启用,根据后端服务器的相应头区域是否有&quot;Via”区域来开启或者是关闭压缩。any就是所有的代理请求都压缩。</p> <h2 id="_8、配置网页缓存时间"><a href="#_8、配置网页缓存时间" class="header-anchor">#</a> 8、配置网页缓存时间</h2> <p>当Nginx将网页数据返回给客户端后，可设置缓存的时间，以方便在日后进行相同内容的请求时直接返回，以避免重复请求，加快了访问速度，一般针对静态资源进行设置, 对动态网页不用设置缓存时间。
下面对图片做缓存配置:</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> ~ \.(gif|jpg|jpeg|png|bmp|ico)$</span> <span class="token punctuation">{</span>		<span class="token comment">#加入新的location</span>
		<span class="token directive"><span class="token keyword">root</span> html</span> <span class="token punctuation">;</span>
		<span class="token directive"><span class="token keyword">expires</span> <span class="token number">1d</span></span><span class="token punctuation">;</span>				<span class="token comment">#指定缓存时间</span>
<span class="token punctuation">}</span>
</code></pre></div><p>设置缓存一天的时间，一天之内浏览器访问这个页面， 都是用缓存中的数据，而不需要向Nginx服务器重新发出请求，减少了服务器的使用带宽。</p> <p><strong>总结：</strong></p> <p><strong>expire功能优点:</strong></p> <ul><li>expires可以降低网站购买的带宽， 节约成本</li> <li>同时提升用户访问体验</li> <li>减轻服务的压力，节约服务器成本，是web服务非常重要的功能。</li> <li><strong>expire功能缺点:</strong></li> <li>被缓存的页面或数据更新了,用户看到的可能还是旧的内容,反而影响用户体验。</li> <li>解决办法:
。第一个缩短缓存时间，例如: 1天,但不彻底，除非更新频率大于1天;
。第二个对缓存的对象改名。</li> <li>网站不希望被缓存的内容:
。网站流量统计工具
。更新频繁的文件(google的logo)</li></ul> <h2 id="_9、防盗链"><a href="#_9、防盗链" class="header-anchor">#</a> 9、防盗链</h2> <p>在企业网站服务中，一般都要配置防盗链功能，以避免网站内容被非法盗用，造成经济损失，也避免了不必要的带宽浪费。Nginx的防盗链功能也非常强大，在默认情况下，只需要进行很简单的配置，即可实现防盗链处理。</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> ~* \.(jpg|gif|swf)$</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">valid_referers</span> none blocked web.test.cn</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$invalid_referer</span>)</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">rewrite</span> ^/ http://web.test.cn/meinv02.jpg</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token directive"><span class="token keyword">root</span>   /usr/share/nginx/html/web</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Nginx的防盗链原理是加入location项，用正则表达式过滤图片类型文件,对于信任的网址可以正常使用，不信任的网址返回相应的错误图片。</p> <h2 id="_10、内核参数优化"><a href="#_10、内核参数优化" class="header-anchor">#</a> 10、内核参数优化</h2> <p>fs.file-max = 999999:</p> <p>这个参数表示进程(比如一个worker进程)可以同时打开的最大句柄数，这个参数直线限制最大并发连接数，需根据实际情况配置。</p> <p>net.ipv4.tcp_max_tw_buckets = 6000</p> <p>这个参数表示操作系统允许TIME_WAIT套接字数量的最大值,如果超过这个数字，TIME_WAIT套接字将立刻被清除并打印警告信息。该参数默认为180000,过多的TIME_WAIT套接字会使Web服务器变慢。
注:主动关闭连接的服务端会产生 TIME_WAIT状态的连接</p> <p>net.ipv4.ip_local_port_range = 1024 65000
允许系统打开的端口范围</p> <p>net.ipv4.tcp_tw_recycle= 1
启用timewait快速回收</p> <p>net.ipv4.tcp_tw_reuse= 1
开启重用。允许将TIME-WAIT sockets重新用于新的TCP连接。这对于服务器来说很有意义,因为服务器上总会有大量TIME-WAIT状态的连接。</p> <p>net.ipv4.tcp_keepalive_time= 30
这个参数表示当keepalive启用时，TCP发送keepalive消息的频度。默认是2小时,若将其设置的小一些，可以更快地清理无效的连接。</p> <p>net.ipv4.tcp_syncookies= 1
开启SYN Cookies当出现SYN等待队列溢出时，启用cookies来处理。该参数与性能无关，用于解决TCP的SYN攻击。</p> <p>net.core.somaxconn = 40960
somaxconn参数:定义了系统中每一个端口最大的监听队列的长度，这是个全局的参数默认值为128，对于一个经常处理新连接的高负载web服务环境来说，默认的128太小了。大多数环境这个值建议增加到1024或者更多。大的侦听队列对防止拒绝服务DoS攻击也会有所帮助。
web应用中listen函数的backlog默认会给我们内核参数的net.core.somaxconn限制到128,而nginx定义的NGX_LISTEN_BACKLOG 默认为511,所以有必要调整这个值。
注:对于一 个TCP连接, Server与Client需要通过三次握手来建立网络连接.当三次握手成功后,我们可以看到端口的状态由LISTEN转变为ESTABLISHED（ [ɪˈstæblɪʃt] 建立），接着这条链路上就可以开始传送数据了。每一个处于监听(Listen)状态的端口,都有自己的监听队列.监听队列的长度与此somaxconn参数和使用该端口的程序中listen()函数有关</p> <p>net.core.netdev_max_backlog = 262144
每个网络接口接收数据包的速率比内核处理这些包的速率快时，允许送到队列的数据包的最大数目。</p> <p>net.ipv4.tcp_max_syn_backlog = 262144
这个参数标示TCP三次握手建立阶段接受SYN请求队列的最大长度,默认为1024,将其设置得大一些可以使出现Nginx繁忙来不及accept新连接的情况时，Linux 不至于丢失客户端发起的连接请求。</p> <p>net.ipv4.tcp_rmem = 10240 87380 12582912
这个参数定义了TCP接受缓存(用于TCP接受滑动窗口)的最小值、默认值、最大值。</p> <p>net.ipv4.tcp_wmem = 10240 87380 12582912
这个参数定义了TCP发送缓存(用于TCP发送滑动窗口)的最小值、默认值、最大值。</p> <p>net.core.rmem_default = 6291456
这个参数表示内核套接字接受缓存区默认的大小。</p> <p>net.core.wmem_default = 6291456
这个参数表示内核套接字发送缓存区默认的大小。</p> <p>net.core.rmem_max= 12582912
这个参数表示内核套接字接受缓存区的最大大小。</p> <p>net.core.wmem_max = 12582912
这个参数表示内核套接字发送缓存区的最大大小。</p> <h3 id="内核优化案例"><a href="#内核优化案例" class="header-anchor">#</a> 内核优化案例</h3> <div class="language-nginx extra-class"><pre class="language-nginx"><code>fs.file-max = 99999
net.ipv4.ip_forward = 0
net.ipv4.conf.default.rp_filter = 1
net.ipv4.conf.default.accept_source_route = 0
kernel.sysrq = 0
kernel.core_uses_pid = 1
net.ipv4.tcp_syncookies = 1
kernel.msgmnb = 65536
kernel.msgmax = 65536
kernel.shmmax = 68719476736
kernel.shmall = 4294967296
net.ipv4.tcp_max_tw_buckets = 6000
net.ipv4.tcp_sack = 1
net.ipv4.tcp_window_scaling = 1
net.ipv4.tcp_rmem = 10240 87380 12582912
net.ipv4.tcp_wmem = 10240 87380 12582912
net.core.wmem_default = 8388608
net.core.rmem_default = 8388608
net.core.rmem_max = 16777216
net.core.wmem_max = 16777216
net.core.netdev_max_backlog = 262144
net.core.somaxconn = 40960
net.ipv4.tcp_max_orphans = 3276800
net.ipv4.tcp_max_syn_backlog = 262144
net.ipv4.tcp_timestamps = 0
net.ipv4.tcp_synack_retries = 1
net.ipv4.tcp_syn_retries = 1
net.ipv4.tcp_tw_recycle = 1
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_mem = 94500000 915000000 927000000
net.ipv4.tcp_fin_timeout = 1
net.ipv4.tcp_keepalive_time = 30
net.ipv4.ip_local_port_range = 1024 65000
</code></pre></div><p>执行sysctl -p 使内核修改生效</p> <h3 id="实验优化案例"><a href="#实验优化案例" class="header-anchor">#</a> 实验优化案例</h3> <p><strong>部署实验环境</strong></p> <p>1、部署LNMP环境(略)</p> <p>2、一个完整的Nginx配置文件案例</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">user</span> www www</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">worker_processes</span> <span class="token number">4</span> :
worker_cpu_affinity <span class="token number">0001</span> <span class="token number">0010</span> <span class="token number">0100</span> <span class="token number">1000</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">worker_rlimit_nofile</span> <span class="token number">65535</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">error_log</span> logs/error.log</span><span class="token punctuation">;</span>
<span class="token comment">#error_log logs/error.log notice; </span>
<span class="token comment">#error_log logs/error.log info; </span>
<span class="token directive"><span class="token keyword">pid</span> logs/nginx.pid</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">{</span>
	<span class="token directive"><span class="token keyword">use</span> epoll</span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">worker_connections</span> <span class="token number">8192</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">multi_accept</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
	<span class="token directive"><span class="token keyword">include</span> mime.types</span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">default_type</span> application/octet-stream</span><span class="token punctuation">;</span> 
	<span class="token directive"><span class="token keyword">log_format</span> main <span class="token string">'<span class="token variable">$remote_addr</span> - <span class="token variable">$remote_user</span> [<span class="token variable">$time_local]</span> &quot;<span class="token variable">$request</span>&quot; '</span>
				   <span class="token string">'<span class="token variable">$status</span> <span class="token variable">$body_bytes_sent</span> ”<span class="token variable">$http_referer</span>'</span>
				   <span class="token string">'&quot;<span class="token variable">$http_user_agent</span>&quot; &quot;Shttp_x_forwarded_for&quot;'</span></span><span class="token punctuation">;</span>
	<span class="token comment">#access_log logs/access.log main;</span>
	<span class="token directive"><span class="token keyword">sendfile</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">tcp_nopush</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">keepalive_timeout</span> <span class="token number">65</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">tcp_nodelay</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">client_header_buffer_size</span> <span class="token number">4k</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">open_file_cache</span> max=102400 inactive=20s</span> <span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">open_file_cache_valid</span> <span class="token number">30s</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">open_file_cache_min_uses</span> <span class="token number">1</span>
	client_header_timeout <span class="token number">15</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">client_body_timeout</span> <span class="token number">15</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">reset_timedout_connection</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">send_timeout</span> <span class="token number">15</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">server_tokens</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">client_max_body_size</span> <span class="token number">10m</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">fastcgi_connect</span> timeout <span class="token number">600</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">fastcgi_send</span> timeout <span class="token number">600</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">fastcgi_read</span> timeout <span class="token number">600</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">fastcgi_buffer_size</span> <span class="token number">64k</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">fastcgi_buffers</span> <span class="token number">4</span> <span class="token number">64k</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">fastcgi_busy_buffers_size</span> <span class="token number">128k</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">fastcgi_temp_file_write_size</span> <span class="token number">128k</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">fastcgi_temp</span> path /usr/local/nginx1.10/nginx_tmp</span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">fastcgi_intercept_errors</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">fastcgi_cache_path</span> /usr/local/nginx1.10/fastcgi_cache levels=1:2
	keys_zone=cache_fastcgi:128m inactive=1d max_size=10g</span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">gzip</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">gzip_min_length</span> <span class="token number">2k</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">gzip_buffers</span> <span class="token number">4</span> <span class="token number">32k</span></span><span class="token punctuation">;</span>gzip_http_version <span class="token directive"><span class="token keyword">1.1</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">gzip_comp_level</span> <span class="token number">6</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">gzip_types</span> text/plain text/css text/javascript application/json
application/javascript
application/x-javascript application/xml</span> <span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">gzip_vary</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">gzip_proxied</span> any</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
	<span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span> 
	<span class="token directive"><span class="token keyword">server_name</span> www.shengzhe.com</span><span class="token punctuation">;</span> 
	<span class="token comment">#charset koi8-r;</span>
	<span class="token comment">#access_log logs/host.access.log main;</span>
	<span class="token directive"><span class="token keyword">location</span> ~* ^.+\.(jpg|gif|png|swf|flv|wma|wmv|asf|mp3|mmf|zip|rar)$</span><span class="token punctuation">{</span>
		<span class="token directive"><span class="token keyword">valid_referers</span> none blocked www.shengzhe.com shengzhe.com</span><span class="token punctuation">;</span>
			<span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$invalid_referer</span>)</span> <span class="token punctuation">{</span>
				<span class="token comment">#return 302 http://www.shengzhe.com/img/nolink.jpg;</span>
				<span class="token directive"><span class="token keyword">return</span> <span class="token number">404</span></span><span class="token punctuation">;</span>
				<span class="token directive"><span class="token keyword">break</span></span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token directive"><span class="token keyword">access_log</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
			<span class="token directive"><span class="token keyword">root</span> html</span><span class="token punctuation">;</span>
			<span class="token directive"><span class="token keyword">index</span> index.php index.html index.htm</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token directive"><span class="token keyword">location</span> ~* \.(ico|jpeg|gif|png|bmp|swf|flv)$</span> <span class="token punctuation">{</span>
			<span class="token directive"><span class="token keyword">expires</span> <span class="token number">30d</span></span><span class="token punctuation">;</span>
			<span class="token comment">#log_not_found off;</span>
			<span class="token directive"><span class="token keyword">access_log</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token directive"><span class="token keyword">location</span> ~* \.(js|css)$</span> <span class="token punctuation">{</span>
			<span class="token directive"><span class="token keyword">expires</span> <span class="token number">7d</span></span><span class="token punctuation">;</span>
			<span class="token directive"><span class="token keyword">log_not_found</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
			<span class="token directive"><span class="token keyword">access_log</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token directive"><span class="token keyword">location</span> = /(favicon.ico|roboots.txt)</span> <span class="token punctuation">{</span>
			<span class="token directive"><span class="token keyword">access_log</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
			<span class="token directive"><span class="token keyword">log_not_found</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token directive"><span class="token keyword">location</span> /status</span> <span class="token punctuation">{</span>
			<span class="token directive"><span class="token keyword">stub_status</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
		<span class="token directive"><span class="token keyword">location</span> ~ . *\.(php|php5)?$</span> <span class="token punctuation">{</span>
			<span class="token directive"><span class="token keyword">root</span> html</span><span class="token punctuation">;</span>
			<span class="token directive"><span class="token keyword">fastcgi_pass</span> 127.0.0.1:9000</span><span class="token punctuation">;</span>
			<span class="token directive"><span class="token keyword">fastcgi_index</span> index.php</span><span class="token punctuation">;</span>
			<span class="token directive"><span class="token keyword">include</span> fastcgi.conf</span><span class="token punctuation">;</span>
			<span class="token directive"><span class="token keyword">fastcgi_cache</span> cache_fastcgi</span><span class="token punctuation">;</span>
			<span class="token directive"><span class="token keyword">fastcgi_cache_alid</span> <span class="token number">200</span> <span class="token number">302</span> <span class="token number">1h</span></span><span class="token punctuation">;</span>
			<span class="token directive"><span class="token keyword">fastcgi_cache_valid</span> <span class="token number">301</span> <span class="token number">1d</span></span><span class="token punctuation">;</span>
			<span class="token directive"><span class="token keyword">fastcgi_cache_valid</span> any <span class="token number">1m</span></span><span class="token punctuation">;</span>
			<span class="token directive"><span class="token keyword">fastcgi_cache_min_uses</span> <span class="token number">1</span></span><span class="token punctuation">;</span>
			<span class="token directive"><span class="token keyword">fastcgi_cache_use_stale</span> error timeout invalid_header http_500</span><span class="token punctuation">;</span>
			<span class="token directive"><span class="token keyword">fastcgi_cache_key</span> http://<span class="token variable">$host</span><span class="token variable">$request_uri</span></span><span class="token punctuation">;</span>
		<span class="token comment">#error_page 404 /404.html;</span>
		<span class="token comment"># redirect server error pages to the static page /50x.html</span>
		<span class="token comment">#</span>
		<span class="token directive"><span class="token keyword">error_page</span> <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span> /50x.html</span><span class="token punctuation">;</span>
		<span class="token directive"><span class="token keyword">location</span> = /50x.html</span> <span class="token punctuation">{</span>
			<span class="token directive"><span class="token keyword">root</span> html</span> <span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

</code></pre></div><h3 id="验证、压力测试"><a href="#验证、压力测试" class="header-anchor">#</a> 验证、压力测试</h3> <h4 id="_1-验证防盗链"><a href="#_1-验证防盗链" class="header-anchor">#</a> <strong>1.验证防盗链</strong></h4> <p>使用Apache做为一个测试站点，域名为www.test.com,在测试页上做一个超链接， 链接nginx站点的一张图片</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">cat</span> /var/www/html/index.html
<span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">&quot;http://www.shengzhe.com/11.gif&quot;</span><span class="token operator">&gt;</span>lianjie<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span>
</code></pre></div><p>Nginx站点的网页目录结如下:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ tree -C /usr/local/nginx1.16/html/
/usr/local/nginx1.16/html/
├── <span class="token number">11</span>.gif
├── 50x.html
├── img
│       └── nolink.jpg
├── index.html
├── mysql_test.php
└── test.php

<span class="token number">1</span> directory, <span class="token number">6</span> files
</code></pre></div><p>在客户端浏览器中输入:www.test.com</p> <p><img src="lmages/1.png" alt=""></p> <p>点击页面链接，可以看到防盗链设置已经生效</p> <p><img src="lmages/2.png" alt=""></p> <h4 id="_2-验证gzip功能"><a href="#_2-验证gzip功能" class="header-anchor">#</a> <strong>2.验证gzip功能</strong></h4> <p>使用谷歌浏览器测试访问，如下图显示结果: (提示: 在访问测试页之前按F12键)</p> <p><img src="lmages/3.png" alt=""></p> <p>用户访问test.php文件， 在上图中content-encoding:gzip表明响应给用户的数据是压缩传输。</p> <h4 id="_3-压力测试"><a href="#_3-压力测试" class="header-anchor">#</a> 3.压力测试</h4> <p>网站性能压力测试是服务器网站性能调优过程中必不可缺少的一环。只有让服务器处在高压情况下，才能真正体现出软件、硬件等各种设置不当所暴露出的问题。</p> <p>性能测试工具目前最常见的有以下几种: ab、http_load、webbench、siege。
ab是apache自带的压力测试工具。ab非常实用，它不仅可以对apache服务器进行网站访问压力测试，也可以对或其它类型的服务器进行压力测试。比如nginx、tomcat、 llS等。
需要安装才能使用:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ yum <span class="token function">install</span> httpd-tools -y
</code></pre></div><p>最常用的参数:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>-n	总的要执行多少个请求数
-C	一次要发出的请求数<span class="token punctuation">(</span>并发数<span class="token punctuation">)</span>
</code></pre></div><p>执行以下测试命令</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ ab -C <span class="token number">500</span> -n <span class="token number">50000</span> http://192.168.154.140/index.html
This is ApacheBench, version <span class="token number">2.3</span> <span class="token operator">&lt;</span><span class="token variable">$Revision</span><span class="token builtin class-name">:</span> <span class="token number">1430300</span> $<span class="token operator">&gt;</span>
Copyright <span class="token number">1996</span> Adam Twiss，Zeus Technology Ltd，http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/
Benchmarking <span class="token number">192.168</span>.154.140 <span class="token punctuation">(</span>be patient<span class="token punctuation">)</span>
Completed <span class="token number">5000</span> requests
Completed <span class="token number">10000</span> requests
Completed <span class="token number">15000</span> requests
Completed <span class="token number">20000</span> requests
Completed <span class="token number">25000</span> requests
Completed <span class="token number">30000</span> requests
Completed <span class="token number">35000</span> requests
Completed <span class="token number">40000</span> requests
Completed <span class="token number">45000</span> requests
Completed <span class="token number">50000</span> requests
Finished <span class="token number">50000</span> requests

Server Software:	nginx
Server Hostname <span class="token builtin class-name">:</span>	<span class="token number">192.168</span>.154.140
Server Port:		<span class="token number">80</span>

Document Path:		/index.html
Document Length:	<span class="token number">626</span> bytes

concurrency Level:		<span class="token number">500</span>
Time taken <span class="token keyword">for</span> tests:	<span class="token number">32.916</span> seconds
Complete requests:		<span class="token number">50000</span>
Failed requests <span class="token builtin class-name">:</span>		<span class="token number">12</span>
	<span class="token punctuation">(</span>Connect: <span class="token number">0</span>，Receive: <span class="token number">0</span>，Length: <span class="token number">6</span>，Exceptions: <span class="token number">6</span><span class="token punctuation">)</span>
<span class="token function">write</span> errors:			<span class="token number">0</span>
Total transferred: 		<span class="token number">42600000</span> bytes
HTML transferred:		<span class="token number">31300000</span> bytes
Requests per second:	<span class="token number">1519.01</span> <span class="token punctuation">[</span><span class="token comment">#/sec] (mean)</span>
Time per request:		<span class="token number">329.161</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean<span class="token punctuation">)</span>
Time per request:		<span class="token number">0.658</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean， across a11 concurrent requests <span class="token punctuation">)</span>
Transfer rate:			<span class="token number">1263.87</span> <span class="token punctuation">[</span>Kbytes/sec<span class="token punctuation">]</span> received

Connection Times <span class="token punctuation">(</span>ms <span class="token punctuation">)</span>
			min	mean<span class="token punctuation">[</span>+/-sd<span class="token punctuation">]</span>	median	max
Connect <span class="token builtin class-name">:</span>	   <span class="token number">0</span>  <span class="token number">85</span>  <span class="token number">26.8</span>     <span class="token number">83</span>    <span class="token number">367</span>
Processing:	   <span class="token number">8</span>  <span class="token number">95</span>  <span class="token number">168.8</span>    <span class="token number">92</span>  <span class="token number">15002</span>
waiting:       <span class="token number">2</span>  <span class="token number">64</span>  <span class="token number">28.5</span>     <span class="token number">59</span>    <span class="token number">374</span>
Total <span class="token builtin class-name">:</span>		  <span class="token number">82</span> <span class="token number">181</span> <span class="token number">168.5</span>    <span class="token number">172</span>  <span class="token number">15002</span>

Percentage of the requests served within a certain <span class="token function">time</span> <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
<span class="token number">50</span>%		<span class="token number">172</span>
<span class="token number">66</span>%		<span class="token number">179</span>
<span class="token number">75</span>%		<span class="token number">184</span>
<span class="token number">80</span>%		<span class="token number">187</span>
<span class="token number">90</span>%		<span class="token number">198</span>
<span class="token number">95</span>%		<span class="token number">209</span>
<span class="token number">98</span>%		<span class="token number">250</span>
<span class="token number">99</span>%		<span class="token number">370</span>
<span class="token number">100</span>% 	<span class="token number">15002</span> <span class="token punctuation">(</span>longest request<span class="token punctuation">)</span>
</code></pre></div><p><strong>ab性能指标</strong></p> <p>1、吞吐率(Requests per second)</p> <p>服务器并发处理能力的量化描述，单位是reqs/s, 指的是在某个并发用户数下单位时间内处理的请求数。某个并发用户数下单位时间内能处理的最大请求数,称之为最大吞吐率。</p> <p>记住:吞吐率是基于并发用户数的。这句话代表了两个含义:</p> <ul><li>吞吐率和并发用户数相关</li> <li>不同的并发用户数下,吞吐率一般是不同的</li></ul> <p>计算公式:总请求数/处理完成这些请求数所花费的时间，即
Request per second=Complete requests/Time taken for tests
必须要说明的是，这个数值表示当前机器的整体性能，值越大越好。</p> <p>2.并发连接数(The number of concurrent connections)</p> <p>并发连接数指的是某个时刻服务器所接受的请求数目,简单的讲，就是一个会话</p> <p>3.并发用户数(Concurrency Level)</p> <p>要注意区分这个概念和并发连接数之间的区别，一个用户可能同时会产生多个会话，也即连接数。在HTTP/1.1下，IE7支持两个并发连接，IE8支持6个并发连接， FireFox3支持4个并发连接,所以相应的，我们的并发用户数就得除以这个基数。</p> <p>4.用户平均请求等待时间(Time per request)</p> <p>计算公式:处理完成所有请求数所花费的时间/ (总请求数/并发用户数)，即:</p> <p>Time per request=Time taken for tests/ (Complete requests/Concurrency Level)</p> <p>5.服务器平均请求等待时间(Time per request:across all concurrent requests)</p> <p>计算公式:处理完成所有请求数所花费的时间/总请求数,即:</p> <p>Time taken for/testsComplete requests</p> <p>可以看到，它是吞吐率的倒数。</p> <p>同时，它也等于用户平均请求等待时间/并发用户数,即</p> <p>Time per request/Concurrency Level</p> <p><strong>第二次压力测试，比较两次的差异</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ ab -C <span class="token number">1000</span> -n <span class="token number">10000</span> http://192.168.154.140/index.html
This is ApacheBench，version <span class="token number">2.3</span> <span class="token operator">&lt;</span>SRevision: <span class="token number">1430300</span> $<span class="token operator">&gt;</span>
Copyright <span class="token number">1996</span> Adam Twiss，Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache software Foundation, http://www.apache.org/

Benchmarking <span class="token number">192.168</span>.154.140 <span class="token punctuation">(</span>be patient<span class="token punctuation">)</span>
Completed <span class="token number">10000</span> requests
Completed <span class="token number">20000</span> requests
Completed <span class="token number">30000</span> requests
Completed <span class="token number">40000</span> requests
Completed <span class="token number">50000</span> requests
Completed <span class="token number">60000</span> requests
Completed <span class="token number">70000</span> requests
Completed <span class="token number">80000</span> requests
Completed <span class="token number">90000</span> requests
Completed <span class="token number">100000</span> requests
Finished <span class="token number">100000</span> requests

Server Software:	nginx
Server Hostname <span class="token builtin class-name">:</span>	<span class="token number">192.168</span>.154.140
Server Port:		<span class="token number">80</span>

Document Path:		/index.html
Document Length:	<span class="token number">626</span> bytes

concurrency Level:		<span class="token number">1000</span>
Time taken <span class="token keyword">for</span> tests:	<span class="token number">50.908</span> seconds
Complete requests:		<span class="token number">10000</span>
Failed requests <span class="token builtin class-name">:</span>		<span class="token number">39</span>
	<span class="token punctuation">(</span>Connect: <span class="token number">0</span>，Receive: <span class="token number">0</span>，Length: <span class="token number">6</span>，Exceptions: <span class="token number">6</span><span class="token punctuation">)</span>
<span class="token function">write</span> errors:			<span class="token number">0</span>
Total transferred: 		<span class="token number">85200000</span> bytes
HTML transferred:		<span class="token number">62600000</span> bytes
Requests per second:	<span class="token number">1964.33</span> <span class="token punctuation">[</span><span class="token comment">#/sec] (mean)</span>
Time per request:		<span class="token number">509.080</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean<span class="token punctuation">)</span>
Time per request:		<span class="token number">0.658</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean， across a11 concurrent requests <span class="token punctuation">)</span>
Transfer rate:			<span class="token number">1634.38</span> <span class="token punctuation">[</span>Kbytes/sec<span class="token punctuation">]</span> received


Connection Times <span class="token punctuation">(</span>ms <span class="token punctuation">)</span>
			min	mean<span class="token punctuation">[</span>+/-sd<span class="token punctuation">]</span>	median	 max
Connect <span class="token builtin class-name">:</span>	   <span class="token number">0</span>  <span class="token number">173</span>  	<span class="token number">50.7</span>    <span class="token number">171</span>   <span class="token number">638</span>
Processing:	  <span class="token number">16</span>  <span class="token number">189</span>  <span class="token number">211.9</span>    <span class="token number">183</span>  <span class="token number">15010</span>
waiting:       <span class="token number">3</span>  <span class="token number">122</span>   <span class="token number">54.4</span>    <span class="token number">115</span>    <span class="token number">472</span>
Total <span class="token builtin class-name">:</span>		 <span class="token number">191</span>  <span class="token number">361</span>  <span class="token number">207.8</span>    <span class="token number">349</span>  <span class="token number">15010</span>

Percentage of the requests served within a certain <span class="token function">time</span> <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
<span class="token number">50</span>%		<span class="token number">349</span>
<span class="token number">66</span>%		<span class="token number">359</span>
<span class="token number">75</span>%		<span class="token number">366</span>
<span class="token number">80</span>%		<span class="token number">371</span>
<span class="token number">90</span>%		<span class="token number">385</span>
<span class="token number">95</span>%		<span class="token number">400</span>
<span class="token number">98</span>%		<span class="token number">461</span>
<span class="token number">99</span>%		<span class="token number">603</span>
<span class="token number">100</span>% 	<span class="token number">15010</span> <span class="token punctuation">(</span>longest request<span class="token punctuation">)</span>
</code></pre></div><h4 id="_4-opcache提高php访向速度"><a href="#_4-opcache提高php访向速度" class="header-anchor">#</a> 4.opcache提高PHP访向速度</h4> <p>Opcache的前生是Optimizer+（ [ˈɑptəˌmaɪzər]优化器 ）,它是PHP的官方公司Zend开发的一款闭源但可以免费使用的PHP优化加速组件。Optimizer+将PHP代码预编译生成的脚本文件Opcode缓存在共享内存中供以后反复使用，从而避免了从磁盘读取代码再次编译的时间消耗。同时，它还应用了一些代码优化模式，使得代码执行更快。从而加速PHP的执行。
安装</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ yum <span class="token function">install</span> php72w-opcache -y
</code></pre></div><p>官方推荐配置</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code>opcache.enable=1
opcache.memory_consumption=128
opcache.interned_strings_buffer=8
opcache.max_accelerated files=4000
opcache.revalidate_freq=60
opcache.fast_shutdown=1
opcache.enab1e_cli=1
</code></pre></div><p>测试PHP动态页面</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ ab -C <span class="token number">1000</span> -n <span class="token number">100000</span> http://192.168.154.140/test.php
This is ApacheBench，version <span class="token number">2.3</span> <span class="token operator">&lt;</span><span class="token variable">$Revision</span><span class="token builtin class-name">:</span> <span class="token number">1430300</span> $<span class="token operator">&gt;</span>
Copyright <span class="token number">1996</span> Adam Twiss，Zeus Technology Ltd，http://www.zeustech.net/
Licensed to The Apache software Foundation, http://www.apache.org/

Benchmarking <span class="token number">192.168</span>.154.140 <span class="token punctuation">(</span>be patient<span class="token punctuation">)</span>
Completed <span class="token number">10000</span> requests
Completed <span class="token number">20000</span> requests
Completed <span class="token number">30000</span> requests
Completed <span class="token number">40000</span> requests
Completed <span class="token number">50000</span> requests
Completed <span class="token number">60000</span> requests
Completed <span class="token number">70000</span> requests
Completed <span class="token number">80000</span> requests
Completed <span class="token number">90000</span> requests
Completed <span class="token number">100000</span> requests
Finished <span class="token number">100000</span> requests

Server Software:	nginx
Server Hostname <span class="token builtin class-name">:</span>	<span class="token number">192.168</span>.154.140
Server Port:		<span class="token number">80</span>

Document Path:		/text.php
Document Length:	<span class="token number">73746</span> bytes

concurrency Level:		<span class="token number">1000</span>
Time taken <span class="token keyword">for</span> tests:	<span class="token number">43.004</span> seconds
Complete requests:		<span class="token number">10000</span>
Failed requests <span class="token builtin class-name">:</span>		<span class="token number">0</span>
<span class="token function">write</span> errors:			<span class="token number">0</span>
Total transferred: 		<span class="token number">7392500000</span> bytes
HTML transferred:		<span class="token number">7371600000</span> bytes
Requests per second:	<span class="token number">2325.39</span> <span class="token punctuation">[</span><span class="token comment">#/sec] (mean)</span>
Time per request:		<span class="token number">430.036</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean<span class="token punctuation">)</span>
Time per request:		<span class="token number">0.430</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean， across a11 concurrent requests <span class="token punctuation">)</span>
Transfer rate:			<span class="token number">167875.33</span> <span class="token punctuation">[</span>Kbytes/sec<span class="token punctuation">]</span> received


Connection Times <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
			min	mean<span class="token punctuation">[</span>+/-sd<span class="token punctuation">]</span>	median	 max
Connect <span class="token builtin class-name">:</span>	   <span class="token number">1</span>   <span class="token number">78</span>  	<span class="token number">54.3</span>     <span class="token number">67</span>   <span class="token number">524</span>
Processing:	  <span class="token number">38</span>  <span class="token number">350</span>   <span class="token number">80.6</span>    <span class="token number">343</span>   <span class="token number">824</span>
waiting:       <span class="token number">1</span>   <span class="token number">51</span>   <span class="token number">33.8</span>     <span class="token number">44</span>   <span class="token number">404</span>
Total <span class="token builtin class-name">:</span>		 <span class="token number">112</span>  <span class="token number">428</span>   <span class="token number">77.3</span>    <span class="token number">409</span>   <span class="token number">899</span>

Percentage of the requests served within a certain <span class="token function">time</span> <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
<span class="token number">50</span>%		<span class="token number">405</span>
<span class="token number">66</span>%		<span class="token number">420</span>
<span class="token number">75</span>%		<span class="token number">435</span>
<span class="token number">80</span>%		<span class="token number">449</span>
<span class="token number">90</span>%		<span class="token number">504</span>
<span class="token number">95</span>%		<span class="token number">595</span>
<span class="token number">98</span>%		<span class="token number">694</span>
<span class="token number">99</span>%		<span class="token number">767</span>
<span class="token number">100</span>% 	<span class="token number">899</span> <span class="token punctuation">(</span>longest request<span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/nginx/03_lnmphuan-jing-bu-shu/2.lnmphuan-jing-bu-shu.html" class="prev">
        LNMP环境部署
      </a></span> <span class="next"><a href="/docs/nginx/04_nginxyou-hua-guan-li/2.-nginx-rewrite/nginx-rewrite.html">
        Nginx Rewrite
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.27b283a1.js" defer></script><script src="/docs/assets/js/2.2e8f894a.js" defer></script><script src="/docs/assets/js/16.5dfc5cc5.js" defer></script>
  </body>
</html>
