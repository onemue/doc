(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{424:function(s,t,a){"use strict";a.r(t);var n=a(56),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"nginx安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx安装"}},[s._v("#")]),s._v(" Nginx安装")]),s._v(" "),a("h2",{attrs:{id:"_1-yum方式进行安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-yum方式进行安装"}},[s._v("#")]),s._v(" 1. YUM方式进行安装")]),s._v(" "),a("h3",{attrs:{id:"_1-1设置nginx-yum源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1设置nginx-yum源"}},[s._v("#")]),s._v(" 1.1设置nginx YUM源")]),s._v(" "),a("p",[s._v("官方yum源：http://nginx.org/en/linux_packages.html#RHEL-CentOS")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" yum-utils\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/yum.repos.d/nginx.repo \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nginx-stable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx stable repo\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("baseurl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://nginx.org/packages/centos/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$releasever")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$basearch")]),s._v("/\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gpgcheck")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("enabled")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gpgkey")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://nginx.org/keys/nginx_signing.key\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("module_hotfixes")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nginx-mainline"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx mainline repo\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("baseurl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://nginx.org/packages/mainline/centos/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$releasever")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$basearch")]),s._v("/\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gpgcheck")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("enabled")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gpgkey")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://nginx.org/keys/nginx_signing.key\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("module_hotfixes")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n")])])]),a("h3",{attrs:{id:"_1-2-安装nginx服务-会安装1-16-0版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-安装nginx服务-会安装1-16-0版本"}},[s._v("#")]),s._v(" 1.2 安装nginx服务，会安装1.16.0版本")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nginx\n")])])]),a("h3",{attrs:{id:"_1-3-设置nginx开机启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-设置nginx开机启动"}},[s._v("#")]),s._v(" 1.3 设置nginx开机启动")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ systemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" nginx.service\n$ systemctl start nginx.service\n$ systemctl status nginx.service\n● nginx.service - nginx - high performance web server\n   Loaded: loaded "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/usr/lib/systemd/system/nginx.service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" enabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" vendor preset: disabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   Active: active "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("running"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" since Mon "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-04-13 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":59:12 EDT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 14s ago\n     Docs: http://nginx.org/en/docs/\n  Process: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20145")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/sbin/nginx -c /etc/nginx/nginx.conf "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("code"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("exited, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/SUCCESS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n Main PID: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20146")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   CGroup: /system.slice/nginx.service\n           ├─20146 nginx: master process /usr/sbin/nginx -c /etc/nginx/nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n           └─20147 nginx: worker process\n\nApr "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":59:12 localhost.localdomain systemd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Starting nginx - high perfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nApr "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":59:12 localhost.localdomain systemd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Started nginx - high perfor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nHint: Some lines were ellipsized, use -l to show "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" full.\n")])])]),a("h3",{attrs:{id:"_1-4-防火墙放行htpp服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-防火墙放行htpp服务"}},[s._v("#")]),s._v(" 1.4 防火墙放行htpp服务")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ firewall-cmd --add-service"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http --permanent      \n$ firewall-cmd --reload\n$ firewall-cmd --list-all\n")])])]),a("h3",{attrs:{id:"_1-5-测试是否可以访问nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-测试是否可以访问nginx"}},[s._v("#")]),s._v(" 1.5 测试是否可以访问nginx")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://192.168.58.142\n")])])]),a("h3",{attrs:{id:"_1-6-加载动态模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-加载动态模块"}},[s._v("#")]),s._v(" 1.6 加载动态模块")]),s._v(" "),a("p",[s._v("nginx包是使用所有模块构建的，这些模块不需要额外的库来避免额外的依赖性。从版本1.9.11开始，nginx支持动态模块，以下模块构建为动态的，并作为单独的包提供：")]),s._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[s._v("nginx-module-geoip\nnginx-module-image-filter\nnginx-module-njs\nnginx-module-perl\nnginx-module-xslt\n")])])]),a("p",[s._v("安装动态模块")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nginx-module-image-filter -y\n")])])]),a("p",[s._v("模块会安装在/usr/lib64/nginx/modules/目录中")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" /usr/lib64/nginx/modules/\nngx_http_image_filter_module-debug.so\nngx_http_image_filter_module.so\n")])])]),a("p",[s._v("在配置文件中加载模块，要在main上下文中配置（在 nginx.conf 中最上方写入）")]),s._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("load_module")]),s._v(" modules/ngx_http_image_filter_module.so")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h2",{attrs:{id:"_2-编译安装nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-编译安装nginx"}},[s._v("#")]),s._v(" 2. 编译安装Nginx")]),s._v(" "),a("p",[s._v("Nginx官网提供了三个类型的版本：")]),s._v(" "),a("ol",[a("li",[s._v("Mainline version：nginx的主力版本，为开发版")]),s._v(" "),a("li",[s._v("Stable version：稳定版，在实际生产过程中选择此版本进行安装")]),s._v(" "),a("li",[s._v("Legacy version：历史版本")])]),s._v(" "),a("h3",{attrs:{id:"_2-1-准备工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-准备工作"}},[s._v("#")]),s._v(" 2.1 准备工作")]),s._v(" "),a("ul",[a("li",[s._v("关闭selinux")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ setenforce "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/SELINUX=enforcing/SELINUX=disable/g'")]),s._v(" /etc/selinux/config\n")])])]),a("ul",[a("li",[s._v("创建用户和组")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("groupadd")]),s._v(" www \n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" -M -g www -s /sbin/nologin www\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" www\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("uid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("www"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("www"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("groups")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("www"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("ul",[a("li",[s._v("安装一些依赖库")])]),s._v(" "),a("p",[s._v("首先下载gcc编译器以及nginx一些模块的依赖库，通常有pcre库 （支持rewrite模块），zlib（支持gzip模块）库，openssl (支持ssl模块)库等。这些库可以编译安装，也可以yum安装，这里选择yum安装。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" gcc gcc-c++ pcre pcre-devel  zlib zlib-devel openssl openssl-devel -y\n")])])]),a("ul",[a("li",[s._v("下载源码包并解压")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://nginx.org/download/nginx-1.16.0.tar.gz\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" zxvf nginx-1.16.0.tar.gz -C /usr/src/\n")])])]),a("ul",[a("li",[a("p",[s._v("安装2个第三方模块")]),s._v(" "),a("p",[s._v("使用nginx-sticky-module扩展模块实现Cookie会话黏贴（保持会话）")]),s._v(" "),a("p",[s._v("使用ngx_cache_purge 实现更强大的缓存清除功能")])])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/FRiCKLE/ngx_cache_purge/archive/master.zip\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v(" master.zip\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" ngx_cache_purge-master/ /usr/src/\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" -c https://bitbucket.org/nginx-goodies/nginx-sticky-module-ng/get/08a395c66e42.zip\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v(" 08a395c66e42.zip -d /usr/src/  \n")])])]),a("h3",{attrs:{id:"_2-2-编译并安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-编译并安装"}},[s._v("#")]),s._v(" 2.2 编译并安装")]),s._v(" "),a("ul",[a("li",[s._v("使用configure脚本自动生成Makefile文件")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/src/nginx-1.16.0/\n$ ./configure --prefix"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/nginx1.16 --user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("www --group"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("www "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --with-http_stub_status_module "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --with-http_realip_module "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --with-http_ssl_module "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --with-http_gzip_static_module "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --http-client-body-temp-path"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/tmp/nginx/client "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --http-proxy-temp-path"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/tmp/nginx/proxy "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --http-fastcgi-temp-path"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/tmp/nginx/fcgi "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --with-pcre "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --with-http_flv_module "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --add-module"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/ngx_cache_purge-master "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --add-module"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/nginx-goodies-nginx-sticky-module-ng-08a395c66e42\n")])])]),a("ul",[a("li",[s._v("编译并安装")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v(" $ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n $ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])])]),a("ul",[a("li",[s._v("完成后优化")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /usr/local/nginx1.16/sbin/nginx /usr/local/sbin/\n$ nginx -t\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /var/tmp/nginx/client -p\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R www:www /var/tmp/nginx/\n$ nginx -t\nnginx: the configuration "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" /usr/local/nginx1.16/conf/nginx.conf syntax is ok\nnginx: configuration "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" /usr/local/nginx1.16/conf/nginx.conf "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" is successful\n$ nginx   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动服务")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -antp "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" nginx\ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:80              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16830")]),s._v("/nginx: master \n$ nginx -s reload    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重启服务")]),s._v("\n$ nginx -s stop      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#停止服务")]),s._v("\n\n")])])]),a("ul",[a("li",[s._v("生成systemed启动脚本")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/lib/systemd/system/nginx.service\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对服务的说明")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx - high performance web server   \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 文档")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Documentation")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://nginx.org/en/docs/\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果该字段指定的 Unit 也要启动，那么必须在当前 Unit 之前启动")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("After")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network-online.target remote-fs.target nss-lookup.target\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 与当前 Unit 配合的其他 Unit，如果它们没有运行，当前 Unit 不会启动失败")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Wants")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network-online.target\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动方式")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("forking\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#PID文件的路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PIDFile")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/nginx1.16/logs/nginx.pid\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/sbin/nginx -c /usr/local/nginx1.16/conf/nginx.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重启命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecReload")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/bin/kill -s HUP "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MAINPID")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#停止命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStop")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/bin/kill -s "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("TERM")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MAINPID")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动模式")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# WantedBy的值是一个或多个 Target，当前 Unit 激活时（enable）符号链接会放入/etc/systemd/system目录下面以 Target 名 + .wants后缀构成的子目录中")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target \n\n$ systemctl daemon-reload\n$ systemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" nginx.service\n$ systemctl restart nginx.service\n$ systemctl status nginx.service\n● nginx.service - nginx - high performance web server\n   Loaded: loaded "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/usr/lib/systemd/system/nginx.service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" enabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" vendor preset: disabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   Active: active "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("running"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" since 二 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-04-14 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":07:38 CST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 21s ago\n     Docs: http://nginx.org/en/docs/\n  Process: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16967")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/sbin/nginx -c /usr/local/nginx1.16/conf/nginx.conf "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("code"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("exited, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/SUCCESS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n Main PID: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16968")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   CGroup: /system.slice/nginx.service\n           ├─16968 nginx: master process /usr/local/sbin/nginx -c /usr/local/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n           └─16969 nginx: worker process\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("月 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":07:38 localhost.localdomain systemd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Starting nginx - high perf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("月 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":07:38 localhost.localdomain systemd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Can't "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" PID "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" /usr/l"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("月 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":07:38 localhost.localdomain systemd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Started nginx - high perfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nHint: Some lines were ellipsized, use -l to show "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" full.\n")])])]),a("h3",{attrs:{id:"注"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注"}},[s._v("#")]),s._v(" 注：")]),s._v(" "),a("p",[s._v("如果你想在已经安装好的nginx上添加第三方模块，依然需要重新编译，但为了不覆盖你原有的配置，请不要 make install，而是直接拷贝可执行文件:")]),s._v(" "),a("p",[s._v("查看原有的编译配置")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ nginx -V\n")])])]),a("p",[s._v("重新编译")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ ./configure --add-module"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#第三方模块")]),s._v("\n\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#make 后不要make install ，改为手动拷贝，先备份")]),s._v("\n\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /usr/local/nginx1.16/sbin/nginx /usr/local/nginx1.16/sbin/nginx.bak\n\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" objs/nginx /usr/local/nginx1.16/sbin/nginx\n")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);